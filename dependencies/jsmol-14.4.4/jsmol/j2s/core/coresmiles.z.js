(function(Q,R,S,T,U,v,G,A,C,D,O,V,E,W,F,w,H,M,N,I,K,X,P,Y,Z,$,aa,ba,ca,L,da,ea,fa,ga,ha,ia,ja,ka,la,ma,na,oa,pa,qa,ra,sa,ta,ua,va,wa,xa,ya,za,Aa,Ba,Ca,Da,h,n){v("JS");A(["JU.BS","$.V3"],"JS.VTemp",null,function(){c$=D(function(){this.bsTemp=this.vNorm4=this.vNorm3=this.vNorm2=this.vTemp2=this.vTemp1=this.vB=this.vA=this.vTemp=null;C(this,arguments)},JS,"VTemp");I(c$,function(){this.vTemp=new JU.V3;this.vA=new JU.V3;this.vB=new JU.V3;this.vTemp1=new JU.V3;this.vTemp2=new JU.V3;this.vNorm2=new JU.V3;
this.vNorm3=new JU.V3;this.vNorm4=new JU.V3;this.bsTemp=new JU.BS})});v("J.api");P(J.api,"SmilesMatcherInterface");v("JS");A(["J.api.SmilesMatcherInterface"],"JS.SmilesMatcher","JU.AU $.BS $.PT JS.InvalidSmilesException $.SmilesAtom $.SmilesBond $.SmilesGenerator $.SmilesParser $.SmilesSearch JU.BNode $.BSUtil $.Elements $.Logger $.Node $.Point3fi".split(" "),function(){c$=N(JS,"SmilesMatcher",null,J.api.SmilesMatcherInterface);n(c$,"getLastException",function(){return JS.InvalidSmilesException.getLastError()});
n(c$,"getMolecularFormula",function(a,b){JS.InvalidSmilesException.clear();var c=JS.SmilesParser.getMolecule("/nostereo/"+a,b);c.createTopoMap(null);c.nodes=c.jmolAtoms;return c.getMolecularFormula(!b,null,!1)},"~S,~B");n(c$,"getSmiles",function(a,b,c,e,d){JS.InvalidSmilesException.clear();return(new JS.SmilesGenerator).getSmiles(a,b,c,e,d)},"~A,~N,JU.BS,~S,~N");n(c$,"areEqual",function(a,b){JS.InvalidSmilesException.clear();var c=this.findPriv(a,JS.SmilesParser.getMolecule(b,!1),(0<=a.indexOf("*")?
2:1)|32,2);return null==c?-1:c.length},"~S,~S");h(c$,"areEqualTest",function(a,b){var c=this.findPriv(a,b,33,2);return null!=c&&1==c.length},"~S,JS.SmilesSearch");n(c$,"find",function(a,b,c,e){JS.InvalidSmilesException.clear();b=JS.SmilesParser.cleanPattern(b);a=JS.SmilesParser.cleanPattern(a);b=JS.SmilesParser.getMolecule(b,!1);a=this.findPriv(a,b,(c?2:1)|(e?32:0),3);for(c=a.length;0<=--c;){e=a[c];for(var d=e.length;0<=--d;)e[d]=b.jmolAtoms[e[d]].mapIndex}return a},"~S,~S,~B,~B");n(c$,"getRelationship",
function(a,b){if(null==a||null==b||0==a.length||0==b.length)return"";var c=this.getMolecularFormula(a,!1),e=this.getMolecularFormula(b,!1);if(!c.equals(e))return"none";var d,c=JU.PT.countChar(JU.PT.rep(a,"@@","@"),"@"),e=JU.PT.countChar(JU.PT.rep(b,"@@","@"),"@");d=c==e&&0<this.areEqual(b,a);if(!d){d=a+b;if(0<=d.indexOf("/")||0<=d.indexOf("\\")||0<=d.indexOf("@")){if(c==e&&(0<c&&0>d.indexOf("@SP"))&&(d=0<this.areEqual("/invertstereo/"+b,a)))return"enantiomers";if(d=0<this.areEqual("/nostereo/"+b,
a))return c==e?"diastereomers":"ambiguous stereochemistry!"}return"constitutional isomers"}return"identical"},"~S,~S");n(c$,"reverseChirality",function(a){a=JU.PT.rep(a,"@@","!@");a=JU.PT.rep(a,"@","@@");return a=JU.PT.rep(a,"!@@","@")},"~S");n(c$,"getSubstructureSet",function(a,b,c,e,d){return this.matchPriv(a,b,c,e,null,!0,d,1)},"~S,~A,~N,JU.BS,~N");n(c$,"getMMFF94AtomTypes",function(a,b,c,e,d,f){JS.InvalidSmilesException.clear();var k=new JS.SmilesParser(!0),g=null,g=k.parse("");g.exitFirstMatch=
!1;g.jmolAtoms=b;g.jmolAtomCount=Math.abs(c);g.setSelected(e);g.flags=1794;g.getRingData(f,!0,!0);g.asVector=!1;g.subSearches=Array(1);g.getSelections();b=new JU.BS;for(e=0;e<a.length;e++)if(null==a[e]||0==a[e].length||a[e].startsWith("#"))d.addLast(null);else if(g.clear(),f=k.getSearch(g,JS.SmilesParser.cleanPattern(a[e]),1794),g.subSearches[0]=f,f=JU.BSUtil.copy(g.search()),d.addLast(f),b.or(f),b.cardinality()==c)break},"~A,~A,~N,JU.BS,JU.Lst,~A");n(c$,"getSubstructureSetArray",function(a,b,c,e,
d,f){return this.matchPriv(a,b,c,e,d,!0,f,2)},"~S,~A,~N,JU.BS,JU.BS,~N");n(c$,"polyhedronToSmiles",function(a,b,c,e,d,f){for(var k=Array(c),g=0;g<c;g++){k[g]=new JS.SmilesAtom;var j=null==e?null:e[g];G(j,JU.Node)?(k[g].elementNumber=j.getElementNumber(),k[g].atomName=j.getAtomName(),k[g].atomNumber=j.getAtomNumber(),k[g].setT(j)):k[g].elementNumber=G(j,JU.Point3fi)?j.sD:-2;k[g].index=g}j=0;for(g=b.length;0<=--g;)for(var h=b[g],m=h.length,l,s,q=m;0<=--q;)if(!((l=h[q])>=c||(s=h[(q+1)%m])>=c)&&null==
k[l].getBondTo(k[s]))(new JS.SmilesBond(k[l],k[s],1,!1)).index=j++;for(g=0;g<c;g++)if(m=k[g].bondCount,0==m||m!=k[g].bonds.length)k[g].bonds=JU.AU.arrayCopyObject(k[g].bonds,m);b=null;b=new JS.SmilesGenerator;null!=e&&(b.stereoReference=a);JS.InvalidSmilesException.clear();b=b.getSmiles(k,c,JU.BSUtil.newBitSet2(0,c),null,d|53248);65536==(d&65536)&&(b="//* "+a+" *//\t["+JU.Elements.elementSymbolFromNumber(a.getElementNumber())+"@PH"+c+(null==f?"":"/"+f+"/")+"]."+b);return b},"JU.Node,~A,~N,~A,~N,~S");
n(c$,"getCorrelationMaps",function(a,b,c,e,d){return this.matchPriv(a,b,c,e,null,!0,d,3)},"~S,~A,~N,JU.BS,~N");h(c$,"findPriv",function(a,b,c,e){var d=new JU.BS;b.setFlags(b.flags|JS.SmilesParser.getFlags(a));b.createTopoMap(d);return this.matchPriv(a,b.jmolAtoms,-b.jmolAtoms.length,null,d,d.isEmpty(),c,e)},"~S,JS.SmilesSearch,~N,~N");h(c$,"matchPriv",function(a,b,c,e,d,f,k,g){JS.InvalidSmilesException.clear();try{var j=2==(k&2),h=JS.SmilesParser.getMolecule(a,j);h.openSMILES&&(!j&&!h.patternAromatic)&&
JS.SmilesSearch.normalizeAromaticity(h.patternAtoms,d,h.flags);h.jmolAtoms=b;h.jmolAtomCount=Math.abs(c);0>c&&(h.isSmilesFind=!0);var m=!G(b[0],JS.SmilesAtom);G(b[0],JU.BNode)&&(h.bioAtoms=b);h.setSelected(e);h.getSelections();h.bsRequired=null;f||(h.bsAromatic=d);h.setRingData(null,null,m||f);h.exitFirstMatch=32==(k&32);switch(g){case 1:return h.asVector=!1,h.search();case 2:h.asVector=!0;var l=h.search();return l.toArray(Array(l.size()));case 3:h.getMaps=!0;var s=h.search();return s.toArray(JU.AU.newInt2(s.size()))}}catch(q){if(F(q,
Exception))throw JU.Logger.debugging&&q.printStackTrace(),null==JS.InvalidSmilesException.getLastError()&&JS.InvalidSmilesException.clear(),new JS.InvalidSmilesException(JS.InvalidSmilesException.getLastError());throw q;}return null},"~S,~A,~N,JU.BS,JU.BS,~B,~N,~N");n(c$,"cleanSmiles",function(a){return JS.SmilesParser.cleanPattern(a)},"~S");H(c$,"MODE_BITSET",1,"MODE_ARRAY",2,"MODE_MAP",3)});v("JS");A(["java.lang.Exception"],"JS.InvalidSmilesException",null,function(){c$=N(JS,"InvalidSmilesException",
Exception);c$.getLastError=h(c$,"getLastError",function(){return JS.InvalidSmilesException.lastError});c$.clear=h(c$,"clear",function(){JS.InvalidSmilesException.lastError=null});n(c$,"getMessage",function(){return JS.InvalidSmilesException.lastError});E(c$,function(a){K(this,JS.InvalidSmilesException,[a]);JS.InvalidSmilesException.lastError=a.startsWith("Jmol SMILES")?a:"Jmol SMILES Exception: "+a},"~S");H(c$,"lastError",null)});v("JS");A(["JU.JmolMolecule","JU.BS","$.Lst","JS.VTemp"],"JS.SmilesSearch",
"java.lang.Float java.util.Arrays $.Hashtable JU.AU $.SB JS.SmilesAromatic $.SmilesAtom $.SmilesBond $.SmilesMeasure $.SmilesParser JU.BSUtil $.Logger".split(" "),function(){c$=D(function(){this.bioAtoms=this.v=this.jmolAtoms=this.pattern=this.patternAtoms=null;this.jmolAtomCount=0;this.bsRequired=this.bsSelected=null;this.isTopology=this.isSmilesFind=this.isSmarts=this.exitFirstMatch=!1;this.patternAromatic=!0;this.subSearches=null;this.haveBondStereochemistry=this.haveSelected=!1;this.stereo=null;
this.needRingData=!1;this.needAromatic=!0;this.needRingMemberships=!1;this.nDouble=0;this.ringDataMax=-2147483648;this.ringSets=null;this.ringCount=0;this.measures=null;this.flags=0;this.lastChainAtom=this.bsAromatic6=this.bsAromatic5=this.bsAromatic=null;this.getMaps=this.asVector=!1;this.top=null;this.isRingCheck=this.isSilent=!1;this.selectedAtomCount=0;this.htNested=this.bsFound=this.ringConnections=this.ringCounts=this.ringData=null;this.nNested=0;this.bsReturn=this.vReturn=this.nestedBond=null;
this.openSMILES=this.jsmeNoncanonical=this.aromaticDouble=this.noAromatic=this.invertStereochemistry=this.ignoreStereochemistry=!1;this.bsCheck=null;C(this,arguments)},JS,"SmilesSearch",JU.JmolMolecule);I(c$,function(){this.patternAtoms=Array(16);this.v=new JS.VTemp;this.measures=new JU.Lst;this.bsAromatic=new JU.BS;this.bsAromatic5=new JU.BS;this.bsAromatic6=new JU.BS;this.top=this;this.bsFound=new JU.BS;this.bsReturn=new JU.BS});E(c$,function(){K(this,JS.SmilesSearch,[])});h(c$,"toString",function(){var a=
(new JU.SB).append(this.pattern);a.append("\nmolecular formula: "+this.getMolecularFormula(!0,null,!1));return a.toString()});c$.addFlags=h(c$,"addFlags",function(a,b){0<=b.indexOf("OPEN")&&(a|=5);0<=b.indexOf("BIO")&&(a|=1048576);0<=b.indexOf("NONCANONICAL")&&(a|=2048);0<=b.indexOf("STRICT")&&(a|=256);if(0<=b.indexOf("NOAROMATIC")||0<=b.indexOf("NONAROMATIC"))a|=16;0<=b.indexOf("AROMATICDOUBLE")&&(a|=512);0<=b.indexOf("AROMATICDEFINED")&&(a|=128);0<=b.indexOf("MMFF94")&&(a|=1792);0<=b.indexOf("NOSTEREO")?
a|=32:0<=b.indexOf("INVERTSTEREO")&&(a=0!=(a&64)?a&-65:a|64);1048576==(a&1048576)&&(0<=b.indexOf("NOCOMMENT")&&(a|=34603008),0<=b.indexOf("ATOMCOMMENT")&&(a|=131072),0<=b.indexOf("UNMATCHED")&&(a|=3145728),0<=b.indexOf("COVALENT")&&(a|=5242880),0<=b.indexOf("HBOND")&&(a|=9437184));return a},"~N,~S");h(c$,"setFlags",function(a){this.flags=a;this.noAromatic=16==(a&16);this.aromaticDouble=512==(a&512);this.jsmeNoncanonical=2048==(a&2048);this.ignoreStereochemistry=32==(a&32);this.invertStereochemistry=
64==(a&64);this.openSMILES=5==(a&5)},"~N");h(c$,"setSelected",function(a){null==a&&(a=JU.BS.newN(this.jmolAtomCount),a.setBits(0,this.jmolAtomCount));this.bsSelected=a},"JU.BS");h(c$,"setAtomArray",function(){this.patternAtoms.length>this.ac&&(this.patternAtoms=JU.AU.arrayCopyObject(this.patternAtoms,this.ac));this.nodes=this.patternAtoms});h(c$,"addAtom",function(){return this.appendAtom(new JS.SmilesAtom)});h(c$,"appendAtom",function(a){this.ac>=this.patternAtoms.length&&(this.patternAtoms=JU.AU.doubleLength(this.patternAtoms));
return this.patternAtoms[this.ac]=a.setIndex(this.ac++)},"JS.SmilesAtom");h(c$,"addNested",function(a){null==this.top.htNested&&(this.top.htNested=new java.util.Hashtable);this.setNested(++this.top.nNested,a);return this.top.nNested},"~S");h(c$,"clear",function(){this.bsReturn.clearAll();this.nNested=0;this.nestedBond=this.htNested=null;this.clearBsFound(-1)});h(c$,"setNested",function(a,b){this.top.htNested.put("_"+a,b)},"~N,~O");h(c$,"getNested",function(a){return this.top.htNested.get("_"+a)},
"~N");h(c$,"getMissingHydrogenCount",function(){for(var a=0,b,c=0;c<this.ac;c++)if(0<=(b=this.patternAtoms[c].explicitHydrogenCount))a+=b;return a});h(c$,"setRingData",function(a,b,c){this.isTopology&&(this.needAromatic=!1);this.needAromatic&&(this.needRingData=!0);this.needAromatic=(new Boolean(this.needAromatic&(new Boolean(null==a&16!=(this.flags&16))).valueOf())).valueOf();if(!this.needAromatic&&(this.bsAromatic.clearAll(),null!=a&&this.bsAromatic.or(a),!this.needRingMemberships&&!this.needRingData))return;
this.getRingData(b,this.needRingData,c)},"JU.BS,~A,~B");h(c$,"getRingData",function(a,b,c){var e=256==(this.flags&256),d=!e?0:1792==(this.flags&1792)?2:1,f=128==(this.flags&128),k=!e&&5==(this.flags&5),g=this.needAromatic&&c&&(e||k),j=null==a?new JU.Lst:a[3]=new JU.Lst,h=g?new JU.Lst:null,m=g?w(this.jmolAtomCount,0):null;f&&this.needAromatic&&(JS.SmilesAromatic.checkAromaticDefined(this.jmolAtoms,this.bsSelected,this.bsAromatic),d=0);var l=this.jmolAtomCount,s=0<l&&!G(this.jmolAtoms[0],JS.SmilesAtom);
0>this.ringDataMax&&(this.ringDataMax=8);0<d&&6>this.ringDataMax&&(this.ringDataMax=6);b&&(this.ringCounts=w(l,0),this.ringConnections=w(this.jmolAtomCount,0),this.ringData=Array(this.ringDataMax+1));this.ringSets=new JU.SB;for(var q="****",p=this.ringDataMax;q.length<p;)q+=q;for(var r=3;r<=p;r++)if(!(r>l)){var n="*1"+q.substring(0,r-2)+"*1",n=JS.SmilesParser.getMolecule(n,!0),n=this.subsearch(n,!1,!0);if(null!=a&&5>=r){for(var u=new JU.Lst,t=n.size();0<=--t;)u.addLast(n.get(t));a[r-3]=u}if(0!=n.size()&&
(this.needAromatic&&(!f&&5<=r&&7>=r)&&JS.SmilesAromatic.setAromatic(r,this.jmolAtoms,this.bsSelected,n,this.bsAromatic,d,k,s,this.v,j,h,m,c),b)){this.ringData[r]=new JU.BS;for(u=n.size();0<=--u;){var B=n.get(u);this.ringData[r].or(B);for(t=B.nextSetBit(0);0<=t;t=B.nextSetBit(t+1))this.ringCounts[t]++}}}if(this.needAromatic){g&&JS.SmilesAromatic.finalizeAromatic(this.jmolAtoms,this.bsAromatic,j,h,m,k,e);this.bsAromatic5.clearAll();this.bsAromatic6.clearAll();for(r=j.size();0<=--r;)switch(a=j.get(r),
a.and(this.bsAromatic),a.cardinality()){case 5:this.bsAromatic5.or(a);break;case 6:this.bsAromatic6.or(a)}}if(b)for(r=this.bsSelected.nextSetBit(0);0<=r;r=this.bsSelected.nextSetBit(r+1))if(b=this.jmolAtoms[r],j=b.getEdges(),null!=j)for(u=j.length;0<=--u;)0<this.ringCounts[b.getBondedAtomIndex(u)]&&this.ringConnections[r]++},"~A,~B,~B");h(c$,"subsearch",function(a,b,c){a.ringSets=this.ringSets;a.jmolAtoms=this.jmolAtoms;a.bioAtoms=this.bioAtoms;a.jmolAtomCount=this.jmolAtomCount;a.bsSelected=this.bsSelected;
a.htNested=this.htNested;a.isSmilesFind=this.isSmilesFind;a.bsCheck=this.bsCheck;a.isSmarts=!0;a.bsAromatic=this.bsAromatic;a.bsAromatic5=this.bsAromatic5;a.bsAromatic6=this.bsAromatic6;a.ringData=this.ringData;a.ringCounts=this.ringCounts;a.ringConnections=this.ringConnections;b?(a.bsRequired=null,a.exitFirstMatch=!1):c?(a.bsRequired=null,a.isSilent=!0,a.isRingCheck=!0,a.asVector=!0):(a.haveSelected=this.haveSelected,a.bsRequired=this.bsRequired,a.exitFirstMatch=this.exitFirstMatch,a.getMaps=this.getMaps,
a.asVector=this.asVector,a.vReturn=this.vReturn,a.bsReturn=this.bsReturn);return a.search2(b)},"JS.SmilesSearch,~B,~B");h(c$,"search",function(){return this.search2(!1)});h(c$,"search2",function(a){this.setFlags(this.flags);JU.Logger.debugging&&!this.isSilent&&JU.Logger.debug("SmilesSearch processing "+this.pattern);if(null==this.vReturn&&(this.asVector||this.getMaps))this.vReturn=new JU.Lst;null==this.bsSelected&&(this.bsSelected=JU.BS.newN(this.jmolAtomCount),this.bsSelected.setBits(0,this.jmolAtomCount));
this.selectedAtomCount=this.bsSelected.cardinality();if(null!=this.subSearches)for(a=0;a<this.subSearches.length&&!(null!=this.subSearches[a]&&(this.subsearch(this.subSearches[a],!1,!1),this.exitFirstMatch&&(null==this.vReturn?0<=this.bsReturn.nextSetBit(0):0<this.vReturn.size())));a++);else 0<this.ac&&this.checkMatch(null,-1,-1,a);return this.asVector||this.getMaps?this.vReturn:this.bsReturn},"~B");h(c$,"checkMatch",function(a,b,c,e){var d;if(null==a)null==this.nestedBond?this.clearBsFound(-1):this.bsReturn.clearAll();
else{if(this.bsFound.get(c)||!this.bsSelected.get(c))return!0;d=this.jmolAtoms[c];if(!this.isRingCheck&&!this.isTopology){if(null!=a.atomsOr){for(var f=0;f<a.nAtomsOr;f++)if(!this.checkMatch(a.atomsOr[f],b,c,e))return!1;return!0}if(null==a.primitives){if(!this.checkPrimitiveAtom(a,c))return!0}else for(f=0;f<a.nPrimitives;f++)if(!this.checkPrimitiveAtom(a.primitives[f],c))return!0}d=d.getEdges();for(f=a.getBondCount();0<=--f;){var k=a.getBond(f);if(k.getAtomIndex2()==a.index){var g=k.atom1,j=g.getMatchingAtomIndex();
switch(k.order){case 96:case 112:if(!this.checkMatchBond(a,g,k,c,j,null))return!0;break;default:for(var h=0;h<d.length&&(!(d[h].getAtomIndex1()==j||d[h].getAtomIndex2()==j)||!d[h].isCovalent());h++);if(h==d.length||!this.checkMatchBond(a,g,k,c,j,d[h]))return!0}}}this.patternAtoms[a.index].setMatchingAtom(this.jmolAtoms[c],c);if(JU.Logger.debugging&&!this.isSilent){for(f=0;f<=b;f++)JU.Logger.debug("pattern atoms "+this.patternAtoms[f]);JU.Logger.debug("--ss--")}this.bsFound.set(c)}if(!this.continueMatch(b,
c,e))return!1;0<=c&&this.clearBsFound(c);return!0},"JS.SmilesAtom,~N,~N,~B");h(c$,"continueMatch",function(a,b,c){var e,d;if(++a<this.ac){var f=this.patternAtoms[a],k=0<=b?f.getBondTo(null):0==a?this.nestedBond:null;if(null==k){k=JU.BSUtil.copy(this.bsFound);e=JU.BSUtil.copy(this.bsFound);if(0<=f.notBondedIndex){d=this.patternAtoms[f.notBondedIndex];var g=d.getMatchingAtom();if(d.isBioAtom)d=g.getOffsetResidueAtom("\x00",1),0<=d&&k.set(d),d=g.getOffsetResidueAtom("\x00",-1),0<=d&&k.set(d);else{d=
g.getEdges();for(var j=0;j<d.length;j++)k.set(d[j].getOtherAtomNode(g).getIndex())}}b=0<=b&&f.isBioAtom&&(null==f.atomName||null!=f.residueChar);for(g=this.bsSelected.nextSetBit(0);0<=g;g=this.bsSelected.nextSetBit(g+1)){if(!k.get(g)&&!this.checkMatch(f,a,g,c))return!1;b&&(d=this.jmolAtoms[g].getOffsetResidueAtom(f.atomName,1),0<=d&&(g=d-1))}this.bsFound=e;return!0}e=k.atom1.getMatchingAtom();switch(k.order){case 96:g=e.getOffsetResidueAtom(f.atomName,1);if(0<=g){k=JU.BSUtil.copy(this.bsFound);e.getGroupBits(this.bsFound);
if(!this.checkMatch(f,a,g,c))return!1;this.bsFound=k}return!0;case 112:b=new JU.Lst;e.getCrossLinkVector(b,!0,!0);k=JU.BSUtil.copy(this.bsFound);e.getGroupBits(this.bsFound);for(g=2;g<b.size();g+=3)if(!this.checkMatch(f,a,b.get(g).intValue(),c))return!1;this.bsFound=k;return!0}d=e.getEdges();if(null!=d)for(g=0;g<d.length;g++)if(!this.checkMatch(f,a,e.getBondedAtomIndex(g),c))return!1;this.clearBsFound(b);return!0}if(!this.ignoreStereochemistry&&!this.checkStereochemistry())return!0;k=new JU.BS;for(g=
f=0;g<this.ac;g++)if(b=this.patternAtoms[g].getMatchingAtomIndex(),c||!this.top.haveSelected||this.patternAtoms[g].selected){f++;k.set(b);this.patternAtoms[g].isBioAtom&&null==this.patternAtoms[g].atomName&&this.jmolAtoms[b].getGroupBits(k);if(c)break;!this.isSmarts&&0<this.patternAtoms[g].explicitHydrogenCount&&this.getHydrogens(this.jmolAtoms[b],k)}if(null!=this.bsRequired&&!this.bsRequired.intersects(k)||!this.isSmarts&&k.cardinality()!=this.selectedAtomCount)return!0;if(null!=this.bsCheck)if(c){this.bsCheck.clearAll();
for(g=0;g<this.ac;g++)this.bsCheck.set(this.patternAtoms[g].getMatchingAtomIndex());if(this.bsCheck.cardinality()!=this.ac)return!0}else if(k.cardinality()!=this.ac)return!0;this.bsReturn.or(k);if(this.getMaps){a=w(f,0);for(k=g=0;g<this.ac;g++)if(c||!this.top.haveSelected||this.patternAtoms[g].selected)a[k++]=this.patternAtoms[g].getMatchingAtomIndex();this.vReturn.addLast(a);return!this.exitFirstMatch}if(this.asVector){c=!0;for(g=this.vReturn.size();0<=--g&&c;)c=!this.vReturn.get(g).equals(k);if(!c)return!0;
this.vReturn.addLast(k)}if(this.isRingCheck){this.ringSets.append(" ");for(j=3*a+2;--j>a;)this.ringSets.append("-").appendI(this.patternAtoms[(j<=2*a?2*a-j+1:j-1)%a].getMatchingAtomIndex());this.ringSets.append("- ");return!0}return this.exitFirstMatch?!1:k.cardinality()!=this.selectedAtomCount},"~N,~N,~B");h(c$,"clearBsFound",function(a){0>a?null==this.bsCheck&&this.bsFound.clearAll():this.bsFound.clear(a)},"~N");h(c$,"getHydrogens",function(a,b){for(var c=a.getEdges(),e=-1,d=0;d<c.length;d++)if(1==
this.jmolAtoms[a.getBondedAtomIndex(d)].getElementNumber()){e=a.getBondedAtomIndex(d);if(null==b)break;b.set(e)}return 0<=e?this.jmolAtoms[e]:null},"JU.Node,JU.BS");h(c$,"checkPrimitiveAtom",function(a,b){for(var c=this.jmolAtoms[b],e=a.not;;){var d;if(0<a.iNested){e=this.getNested(a.iNested);G(e,JS.SmilesSearch)&&(a.isBioAtom&&(e.nestedBond=a.getBondTo(null)),e=this.subsearch(e,!0,!1),null==e&&(e=new JU.BS),a.isBioAtom||this.setNested(a.iNested,e));e=a.not!=e.get(b);break}if(-2147483648!=a.atomNumber&&
a.atomNumber!=c.getAtomNumber())break;if(0<=a.elementNumber&&a.elementNumber!=c.getElementNumber())break;if(0<=a.jmolIndex&&c.getIndex()!=a.jmolIndex)break;if(null!=a.atomName&&(a.isLeadAtom()?!c.isLeadAtom():!a.atomName.equals(c.getAtomName().toUpperCase())))break;if(a.isBioResidue){if(null!=a.residueName&&!a.residueName.equals(c.getGroup3(!1).toUpperCase()))break;if(-2147483648!=a.residueNumber&&a.residueNumber!=c.getResno())break;if(null!=a.residueChar||-2==a.elementNumber){d=c.getBioSmilesType();
var f=a.getBioSmilesType(),k=!0,g=!1;switch(f){case "\x00":case "*":k=!0;break;case "n":k="r"==d||"c"==d;g=!0;break;case "r":case "c":g=!0;default:k=d==f}if(!k)break;k=c.getGroup1("\x00").toUpperCase();f=null==a.residueChar?"*":a.residueChar.charAt(0);k=f==k.charAt(0);switch(f){case "*":k=!0;break;case "N":k=g?"r"==d||"c"==d:k;break;case "R":k=g?c.isPurine():k;break;case "Y":k=g?c.isPyrimidine():k}if(!k)break}if(a.isBioAtom&&a.notCrossLinked&&c.getCrossLinkVector(null,!0,!0))break}else{if(null!=a.atomType&&
!a.atomType.equals(c.getAtomType()))break;d=a.isAromatic();if(!this.noAromatic&&(!a.aromaticAmbiguous&&d!=this.bsAromatic.get(b))&&(!this.jsmeNoncanonical||a.getExplicitHydrogenCount()!=c.getCovalentHydrogenCount()))break;if(-2147483648!=(d=a.getAtomicMass()))if(g=c.getIsotopeNumber(),0<=d&&d!=g||0>d&&0!=g&&-d!=g)break;if(-2147483648!=(d=a.getCharge())&&d!=c.getFormalCharge())break;d=a.getCovalentHydrogenCount()+a.explicitHydrogenCount;if(0<=d&&d!=c.getCovalentHydrogenCount())break;d=a.implicitHydrogenCount;
if(-2147483648!=d&&(g=c.getImplicitHydrogenCount(),-1==d?0==g:d!=g))break;if(0<a.degree&&a.degree!=c.getCovalentBondCount())break;if(0<a.nonhydrogenDegree&&a.nonhydrogenDegree!=c.getCovalentBondCount()-c.getCovalentHydrogenCount())break;if(this.isSmarts&&0<a.valence&&a.valence!=c.getValence())break;if(0<a.connectivity&&a.connectivity!=c.getCovalentBondCount()+c.getImplicitHydrogenCount())break;if(this.openSMILES&&!Float.isNaN(a.atomClass)&&a.atomClass!=O(c.getFloatProperty("property_atomclass")))break;
if(null!=this.ringData){if(-1<=a.ringSize)if(0>=a.ringSize){if(0==this.ringCounts[b]!=(0==a.ringSize))break}else{c=this.ringData[500==a.ringSize?5:600==a.ringSize?6:a.ringSize];if(null==c||!c.get(b))break;if(!this.noAromatic)if(500==a.ringSize){if(!this.bsAromatic5.get(b))break}else if(600==a.ringSize&&!this.bsAromatic6.get(b))break}if(-1<=a.ringMembership&&(-1==a.ringMembership?0==this.ringCounts[b]:this.ringCounts[b]!=a.ringMembership))break;if(0<=a.ringConnectivity&&(d=this.ringConnections[b],
-1==a.ringConnectivity&&0==d||-1!=a.ringConnectivity&&d!=a.ringConnectivity))break}}e=!e;break}return e},"JS.SmilesAtom,~N");h(c$,"checkMatchBond",function(a,b,c,e,d,f){if(null!=c.bondsOr){for(var k=0;k<c.nBondsOr;k++)if(this.checkMatchBond(a,b,c.bondsOr[k],e,d,f))return!0;return!1}if(!this.isRingCheck&&!this.isTopology)if(null==c.primitives){if(!this.checkPrimitiveBond(c,e,d,f))return!1}else for(a=0;a<c.nPrimitives;a++)if(!this.checkPrimitiveBond(c.primitives[a],e,d,f))return!1;c.matchingBond=f;
return!0},"JS.SmilesAtom,JS.SmilesAtom,JS.SmilesBond,~N,~N,JU.Edge");h(c$,"checkPrimitiveBond",function(a,b,c,e){var d=!1;switch(a.order){case 96:return a.isNot!=(this.bioAtoms[c].getOffsetResidueAtom("\x00",1)==this.bioAtoms[b].getOffsetResidueAtom("\x00",0));case 112:return a.isNot!=this.bioAtoms[b].isCrossLinked(this.bioAtoms[c])}var f=!this.noAromatic&&this.bsAromatic.get(b),k=!this.noAromatic&&this.bsAromatic.get(c);e=e.getCovalentOrder();if(f&&k)switch(a.order){case 17:case 65:d=JS.SmilesSearch.isRingBond(this.ringSets,
b,c);break;case 1:d=!this.isSmarts||!JS.SmilesSearch.isRingBond(this.ringSets,b,c);break;case 2:d=!this.isSmarts||this.aromaticDouble&&(2==e||514==e);break;case 769:case 1025:case 81:case -1:d=!0}else switch(a.order){case 81:case -1:d=!0;break;case 1:case 257:case 513:d=1==e||1041==e||1025==e;break;case 769:d=e==(this.isSmilesFind?33:1);break;case 1025:d=e==(this.isSmilesFind?97:1);break;case 2:d=2==e;break;case 3:d=3==e;break;case 65:d=JS.SmilesSearch.isRingBond(this.ringSets,b,c)}return d!=a.isNot},
"JS.SmilesBond,~N,~N,JU.Edge");c$.isRingBond=h(c$,"isRingBond",function(a,b,c){return null!=a&&0<=a.indexOf("-"+b+"-"+c+"-")},"JU.SB,~N,~N");h(c$,"checkStereochemistry",function(){for(var a=0;a<this.measures.size();a++)if(!this.measures.get(a).check())return!1;if(null!=this.stereo&&!this.stereo.checkStereoChemistry(this,this.v))return!1;if(this.haveBondStereochemistry)for(a=0;a<this.ac;a++){for(var b=this.patternAtoms[a],c=null,e=null,d=null,f=0,k=0,g=0,j,h=b.getBondCount(),m=!1,l=0;l<h;l++){j=b.getBond(l);
var s=j.atom2===b,q=j.order;switch(q){case 769:case 1025:case 2:if(s)continue;c=j.atom2;g=q;(m=2!=q)&&(f=j.isNot?-1:1);break;case 257:case 513:e=s?j.atom1:j.atom2,f=s!=(257==q)?1:-1}}if(m){j=b.getBondNotTo(c,!1);if(null==j)return!1;e=j.getOtherAtom(b);j=c.getBondNotTo(b,!1);if(null==j)return!1;d=j.getOtherAtom(c)}else{if(null==c||0==f)continue;j=b;for(h=0;2==c.getBondCount()&&4==c.getValence();)h++,l=c.getEdges(),l=l[l[0].getOtherAtomNode(c)===j?1:0],j=c,c=l.getOtherAtomNode(c);if(1==h%2)continue;
h=c.getBondCount();for(l=0;l<h&&0==k;l++)switch(j=c.getBond(l),q=j.order,q){case 257:case 513:d=(s=j.atom2===c)?j.atom1:j.atom2,k=s!=(257==q)?1:-1}if(0==k)continue}this.isSmilesFind&&this.setSmilesBondCoordinates(b,c,g);b=b.getMatchingAtom();c=c.getMatchingAtom();e=e.getMatchingAtom();d=d.getMatchingAtom();if(null==e||null==d)return!1;JS.SmilesMeasure.setTorsionData(e,b,c,d,this.v,m);if(m){if(k=769==g?1:-1,g=this.v.vTemp1.dot(this.v.vTemp2),0.05>g||0.95<g||0<this.v.vNorm2.dot(this.v.vNorm3)*f*k)return!1}else if(0>
this.v.vTemp1.dot(this.v.vTemp2)*f*k)return!1}return!0});h(c$,"setSmilesBondCoordinates",function(a,b,c){a=this.jmolAtoms[a.getMatchingAtomIndex()];b=this.jmolAtoms[b.getMatchingAtomIndex()];a.set(-1,0,0);b.set(1,0,0);if(2==c){var e=0,d=0;c=a.getEdges();for(var f=c.length;0<=--f;){var k=c[f];if(2!=k.order){var g=k.getOtherAtomNode(a);g.set(-1,0==e++?-1:1,0);g=k.getAtomIndex2()==a.getIndex()?e:-e;switch(k.order){case 1025:d=g;break;case 1041:d=-g}}}var j=0,e=0;a=Array(2);c=b.getEdges();for(f=c.length;0<=
--f;)if(k=c[f],2!=k.order)switch(g=k.getOtherAtomNode(b),a[e]=g,g.set(1,0==e++?1:-1,0),g=k.getAtomIndex2()==b.getIndex()?e:-e,k.order){case 1025:j=g;break;case 1041:j=-g}0<d*j==(Math.abs(d)%2==Math.abs(j)%2)&&(b=a[0].y,a[0].y=a[1].y,a[1].y=b)}else{c=a.getEdges();e=0;for(f=c.length;0<=--f;)if(k=c[f],k.getOtherAtomNode(a)===b){e=33==k.order?1:-1;break}for(f=c.length;0<=--f;)k=c[f],g=k.getOtherAtomNode(a),g!==b&&g.set(-1,1,0);c=b.getEdges();for(f=c.length;0<=--f;)k=c[f],g=k.getOtherAtomNode(b),g!==a&&
g.set(1,1,-e/2)}},"JS.SmilesAtom,JS.SmilesAtom,~N");h(c$,"getMappedAtoms",function(a,b,c){for(var e=w(null==c[4]?4:null==c[5]?5:6,0),d=0;d<e.length;d++)e[d]=null==c[d]?104+100*d:c[d].getIndex();for(var f,k=a.getEdges(),g=null==b?null:b.getEdges(),d=0;d<e.length;d++){for(f=0;f<k.length&&k[f].getOtherAtomNode(a)!==c[d];f++);if(f<k.length)e[d]=10*f+100+d;else if(null!=b){for(f=0;f<g.length&&g[f].getOtherAtomNode(b)!==c[d];f++);f<g.length&&(e[d]=10*f+300+d)}}java.util.Arrays.sort(e);for(d=0;d<e.length;d++)e[d]%=
10;return e},"JU.Node,JU.Node,~A");h(c$,"createTopoMap",function(a){null==a&&(a=new JU.BS);var b=this.getMissingHydrogenCount();this.jmolAtoms=b=Array(this.ac+b);for(var c=0,e=new JU.BS,d=0;d<this.ac;d++){var f=this.patternAtoms[d],k=f.explicitHydrogenCount;0>k&&(k=0);var g=b[c]=(new JS.SmilesAtom).setAll(0,c,f.symbol,f.getCharge());g.stereo=f.stereo;g.atomName=f.atomName;g.residueName=f.residueName;g.residueChar=f.residueChar;g.residueNumber=f.residueNumber;g.atomNumber=f.residueNumber;g.explicitHydrogenCount=
0;g.isBioAtom=f.isBioAtom;g.bioType=f.bioType;g.$isLeadAtom=f.$isLeadAtom;g.mapIndex=d;g.setAtomicMass(f.getAtomicMass());f.isAromatic()&&a.set(c);!f.isFirst&&(1==k&&0<f.getChiralClass())&&e.set(c);f.setMatchingAtom(null,c++);f=Array(f.getBondCount()+k);for(g.setBonds(f);0<=--k;){f=b[c]=(new JS.SmilesAtom).setAll(0,c,"H",0);f.mapIndex=-d-1;c++;f.setBonds(Array(1));var j=new JS.SmilesBond(g,f,1,!1);JU.Logger.debugging&&JU.Logger.info(""+j)}}for(d=0;d<this.ac;d++){f=this.patternAtoms[d];k=f.getMatchingAtomIndex();
a=b[k];k=f.getBondCount();for(c=0;c<k;c++)if(g=f.getBond(c),g.atom1===f){j=1;switch(g.order){case 769:j=33;break;case 1025:j=97;break;case 257:j=1025;break;case 513:j=1041;break;case 112:case 96:j=g.order;break;case 1:j=1;break;case 17:j=514;break;case 2:j=2;break;case 3:j=3}g=b[g.atom2.getMatchingAtomIndex()];j=new JS.SmilesBond(a,g,j,!1);g.bondCount--;JU.Logger.debugging&&JU.Logger.info(""+j)}else g=b[g.atom1.getMatchingAtomIndex()],j=g.getBondTo(a),a.addBond(j)}for(d=e.nextSetBit(0);0<=d;d=e.nextSetBit(d+
1))f=b[d].getEdges(),j=f[0],f[0]=f[1],f[1]=j},"JU.BS");c$.normalizeAromaticity=h(c$,"normalizeAromaticity",function(a,b,c){var e=new JS.SmilesSearch;e.setFlags(c);e.jmolAtoms=a;e.jmolAtomCount=a.length;e.bsSelected=JU.BSUtil.newBitSet2(0,a.length);c=JU.AU.createArrayOfArrayList(4);e.setRingData(null,c,!0);b.or(e.bsAromatic);if(!b.isEmpty()){b=c[3];for(e=b.size();0<=--e;){c=b.get(e);for(var d=c.nextSetBit(0);0<=d;d=c.nextSetBit(d+1)){var f=a[d];!f.isAromatic()&&!(-2==f.elementNumber||0==f.elementNumber)&&
f.setSymbol(f.symbol.toLowerCase())}}}},"~A,JU.BS,~N");h(c$,"setTop",function(a){this.top=null==a?this:a.getTop()},"JS.SmilesSearch");h(c$,"getTop",function(){return this.top===this?this:this.top.getTop()});h(c$,"getSelections",function(){var a=this.top.htNested;if(!(null==a||0==this.jmolAtoms.length))for(var b=new java.util.Hashtable,c,a=a.entrySet().iterator();a.hasNext()&&((c=a.next())||1);){var e=c.getValue().toString();if(e.startsWith("select")){var d=b.containsKey(e)?b.get(e):this.jmolAtoms[0].findAtomsLike(e.substring(6));
null==d&&(d=new JU.BS);b.put(e,d);c.setValue(d)}}});c$.getNormalThroughPoints=h(c$,"getNormalThroughPoints",function(a,b,c,e,d,f){d.sub2(b,a);f.sub2(c,a);e.cross(d,f);e.normalize();d.setT(a);return-d.dot(e)},"JU.Node,JU.Node,JU.Node,JU.V3,JU.V3,JU.V3");H(c$,"NO_AROMATIC",16,"IGNORE_STEREOCHEMISTRY",32,"INVERT_STEREOCHEMISTRY",64,"AROMATIC_DEFINED",128,"AROMATIC_STRICT",256,"AROMATIC_DOUBLE",512,"AROMATIC_MMFF94",1792,"AROMATIC_JSME_NONCANONICAL",2048,"INITIAL_ATOMS",16)});v("JS");A(["java.util.Hashtable",
"JU.BS","JS.VTemp"],"JS.SmilesGenerator","JU.AU $.Lst $.SB JS.InvalidSmilesException $.SmilesAtom $.SmilesBond $.SmilesParser $.SmilesSearch $.SmilesStereo JU.BNode $.BSUtil $.Elements $.JmolMolecule $.Logger".split(" "),function(){c$=D(function(){this.atoms=null;this.ac=0;this.bsAromatic=this.bsSelected=null;this.flags=0;this.explicitH=!1;this.vTemp=this.ringSets=null;this.nPairsMax=this.nPairs=0;this.bsIncludingH=this.bsRingKeys=this.htRings=this.htRingsSequence=this.prevSp2Atoms=this.prevAtom=
this.bsToDo=this.bsBondsDn=this.bsBondsUp=null;this.topologyOnly=!1;this.getAromatic=!0;this.openSMILES=this.noStereo=this.noBioComment=this.addAtomComment=!1;this.smilesStereo=this.stereoReference=null;this.isPolyhedral=!1;this.atemp=this.aromaticRings=null;C(this,arguments)},JS,"SmilesGenerator");I(c$,function(){this.vTemp=new JS.VTemp;this.bsBondsUp=new JU.BS;this.bsBondsDn=new JU.BS;this.htRingsSequence=new java.util.Hashtable;this.htRings=new java.util.Hashtable;this.bsRingKeys=new JU.BS});h(c$,
"getSmiles",function(a,b,c,e,d){var f=c.nextSetBit(0);if(0>f)return"";this.flags=d;this.atoms=a;this.ac=b;this.bsSelected=c=JU.BSUtil.copy(c);this.flags=d=JS.SmilesSearch.addFlags(d,null==e?"":e.toUpperCase());if(1048576==(d&1048576))return this.getBioSmiles(c,e,d);this.openSMILES=5==(d&5);this.addAtomComment=131072==(d&131072);this.explicitH=4096==(d&4096);this.topologyOnly=8192==(d&8192);this.getAromatic=16384!=(d&16384);this.noStereo=32768==(d&32768);this.isPolyhedral=65536==(d&65536);return this.getSmilesComponent(a[f],
c,!0,!1,!1)},"~A,~N,JU.BS,~S,~N");h(c$,"getBioSmiles",function(a,b,c){this.addAtomComment=131072==(c&131072);var e=3145728==(c&3145728),d=34603008==(c&34603008),f=5242880==(c&5242880);c=9437184==(c&9437184);var k=f||c,g=new JU.SB;null!=b&&!this.noBioComment&&g.append("//* Jmol bioSMILES ").append(b.$replace("*","_")).append(" *//");b=this.noBioComment?"":"\n";var j=new JU.BS,h=null,m="",l,s=new JU.Lst;try{for(var q=0,p=a.nextSetBit(0);0<=p;p=a.nextSetBit(p+1)){var r=this.atoms[p],n=r.getGroup1("?"),
u=r.getBioStructureTypeName(),t=n===n.toLowerCase();if(null!=b)if(0<g.length()&&g.append(b),b=null,q=0,0<u.length)0!=r.getChainID()&&!d&&(l="//* chain "+r.getChainIDStr()+" "+u+" "+r.getResno()+" *// ",q=l.length,g.append(l)),q++,g.append("~").appendC(u.toLowerCase().charAt(0)).append("~");else{l=this.getSmilesComponent(r,a,!1,!0,!0);if(l.equals(h)){b="";continue}var h=l,B=r.getGroup3(!0),x;d?x="/"+l+"/":(null!=B&&(l="//* "+B+" *//"+l),x=l+"//");if(0<=m.indexOf(x)){b="";continue}m+=x;g.append(l);
b=d?".":".\n";continue}75<=q&&!d&&(g.append("\n  "),q=2);this.addAtomComment&&g.append("\n//* ["+r.getGroup3(!1)+"#"+r.getResno()+"] *//\t");t?this.addBracketedBioName(g,r,0<u.length?".0":null,!1):g.append(n);q++;if(k){r.getCrossLinkVector(s,f,c);for(var w=0;w<s.size();w+=3)g.append(":"),l=this.getRingCache(s.get(w).intValue(),s.get(w+1).intValue(),this.htRingsSequence),g.append(l),q+=1+l.length;s.clear()}r.getGroupBits(j);a.andNot(j);var z=r.getOffsetResidueAtom("\x00",1);if(0>z||!a.get(z)){d||g.append(" //* ").appendI(r.getResno()).append(" *//");
if(0>z&&0>(z=a.nextSetBit(p+1)))break;0<q&&(b=d?".":".\n")}p=z-1}}catch(y){if(F(y,Exception))throw new JS.InvalidSmilesException("//* error: "+y.getMessage()+" *//");throw y;}if(!e&&!this.htRingsSequence.isEmpty())throw this.dumpRingKeys(g,this.htRingsSequence),new JS.InvalidSmilesException("//* ?ring error? *//");l=g.toString();l.endsWith(".\n")?l=l.substring(0,l.length-2):d&&l.endsWith(".")&&(l=l.substring(0,l.length-1));return l},"JU.BS,~S,~N");h(c$,"addBracketedBioName",function(a,b,c,e){a.append("[");
if(null!=c&&G(b,JU.BNode)){var d=b.getChainIDStr();a.append(b.getGroup3(!1));c.equals(".0")||a.append(c).append("#").appendI(b.getElementNumber());e&&(a.append("//* ").appendI(b.getResno()),0<d.length&&a.append(":").append(d),a.append(" *//"))}else a.append(JU.Elements.elementNameFromNumber(b.getElementNumber()));a.append("]")},"JU.SB,JU.Node,~S,~B");h(c$,"getSmilesComponent",function(a,b,c,e,d){!this.explicitH&&(1==a.getElementNumber()&&0<a.getEdges().length)&&(a=this.atoms[a.getBondedAtomIndex(0)]);
this.bsSelected=JU.JmolMolecule.getBranchBitSet(this.atoms,a.getIndex(),JU.BSUtil.copy(b),null,-1,!0,c);b.andNot(this.bsSelected);this.bsIncludingH=JU.BSUtil.copy(this.bsSelected);if(!this.explicitH)for(b=this.bsSelected.nextSetBit(0);0<=b;b=this.bsSelected.nextSetBit(b+1))c=this.atoms[b],1==c.getElementNumber()&&0==c.getIsotopeNumber()&&this.bsSelected.clear(b);this.getAromatic&&!this.topologyOnly&&2<this.bsSelected.cardinality()?(b=JS.SmilesParser.getMolecule("A[=&@]A",!0),b.jmolAtoms=this.atoms,
G(this.atoms,Array)&&(b.bioAtoms=this.atoms),b.setSelected(this.bsSelected),b.jmolAtomCount=this.ac,b.ringDataMax=7,b.flags=this.flags,c=JU.AU.createArrayOfArrayList(4),b.setRingData(null,c,!0),this.bsAromatic=b.bsAromatic,this.ringSets=b.ringSets,this.aromaticRings=c[3],this.setBondDirections()):this.bsAromatic=new JU.BS;this.bsToDo=JU.BSUtil.copy(this.bsSelected);b=new JU.SB;for(c=this.bsToDo.nextSetBit(0);0<=c;c=this.bsToDo.nextSetBit(c+1))if(4<this.atoms[c].getCovalentBondCount()||this.isPolyhedral)null==
a&&b.append("."),this.getSmilesAt(b,this.atoms[c],e,!1,this.explicitH,d),a=null;if(null!=a)for(;null!=(a=this.getSmilesAt(b,a,e,!0,this.explicitH,d)););for(;0<this.bsToDo.cardinality()||!this.htRings.isEmpty();){a=this.htRings.values().iterator();if(a.hasNext()){if(a=this.atoms[a.next()[1].intValue()],!this.bsToDo.get(a.getIndex()))break}else a=this.atoms[this.bsToDo.nextSetBit(0)];b.append(".");for(this.prevAtom=this.prevSp2Atoms=null;null!=(a=this.getSmilesAt(b,a,e,!0,this.explicitH,d)););}if(!this.htRings.isEmpty())throw this.dumpRingKeys(b,
this.htRings),new JS.InvalidSmilesException("//* ?ring error? *//\n"+b);return b.toString()},"JU.Node,JU.BS,~B,~B,~B");h(c$,"getBondStereochemistry",function(a,b){if(null==a)return"\x00";var c=a.index,e=null==b||a.getAtomIndex1()==b.getIndex();return this.bsBondsUp.get(c)?e?"/":"\\":this.bsBondsDn.get(c)?e?"\\":"/":"\x00"},"JU.Edge,JU.Node");h(c$,"setBondDirections",function(){for(var a=new JU.BS,b=L(2,3,null),c=this.bsSelected.nextSetBit(0);0<=c;c=this.bsSelected.nextSetBit(c+1))for(var e=this.atoms[c],
d=e.getEdges(),f=0;f<d.length;f++){var k=d[f],g=k.index,j;if(!a.get(g)&&!(2!=k.getCovalentOrder()||JS.SmilesSearch.isRingBond(this.ringSets,c,(j=k.getOtherAtomNode(e)).getIndex()))){a.set(g);k=0;for(g=e;2==j.getBondCount()&&4==j.getValence();){var h=j.getEdges(),h=h[h[0].getOtherAtomNode(j)===g?1:0];a.set(h.index);g=j;j=h.getOtherAtomNode(j);k++}if(1!=k%2){var m=k=null,g=0,h=L(-1,[e,j]);JU.Logger.debugging&&JU.Logger.debug(e+" == "+j);for(var m=1,l=0;2>l&&0<m&&3>m;l++)for(var m=0,s=h[l],q=s.getEdges(),
p=0;p<q.length;p++)1!=q[p].getCovalentOrder()||1==q[p].getOtherAtomNode(s).getElementNumber()||(b[l][m++]=q[p],"\x00"!=this.getBondStereochemistry(q[p],s)&&(k=q[p],g=l));if(!(3==m||0==m))if(null==k&&(g=0,k=b[g][0],this.bsBondsUp.set(k.index)),s=this.getBondStereochemistry(k,h[g]),m=k.getOtherAtomNode(h[g]),null!=m)for(l=0;2>l;l++)for(q=0;2>q;q++)if(p=b[l][q],!(null==p||p===k)){var r=p.index,n=p.getOtherAtomNode(h[l]);if(null!=n){var u=this.getBondStereochemistry(p,h[l]),t=JS.SmilesStereo.isDiaxial(h[g],
h[l],m,n,this.vTemp,0);"\x00"==u||u!=s==t?("\\"==s&&t||"/"==s&&!t)==(p.getAtomIndex1()!=n.getIndex())?this.bsBondsUp.set(r):this.bsBondsDn.set(r):JU.Logger.error("BOND STEREOCHEMISTRY ERROR");JU.Logger.debugging&&JU.Logger.debug(this.getBondStereochemistry(k,h[0])+" "+m.getIndex()+" "+n.getIndex()+" "+this.getBondStereochemistry(p,h[l]))}}}}}});h(c$,"getSmilesAt",function(a,b,c,e,d,f){var k=b.getIndex();if(!this.bsToDo.get(k))return null;this.bsToDo.clear(k);var g=!this.bsSelected.get(k),j=null==
this.prevAtom?-1:this.prevAtom.getIndex(),h=this.bsAromatic.get(k),m=null!=this.prevSp2Atoms,l=this.prevSp2Atoms,s=0,q=b.getElementNumber(),p=0,r=new JU.Lst,n=null,u=null,t=b.getEdges();null!=this.stereoReference&&(e=!1,this.sortBonds(b,this.prevAtom,this.stereoReference));var B=null,x=h?10:0,w=Array(7);JU.Logger.debugging&&JU.Logger.debug(a.toString());if(null!=t)for(var z=t.length;0<=--z;){var y=t[z];if(y.isCovalent()){var v=t[z].getOtherAtomNode(b),y=v.getIndex();if(y==j)u=t[z];else{var A=!d&&
1==v.getElementNumber()&&0==v.getIsotopeNumber();if(!this.bsIncludingH.get(y))if(!A&&c&&this.bsSelected.get(k))this.bsToDo.set(y);else continue;A?(B=v,p++,1<p&&(x=10)):r.addLast(t[z])}}}A=null;null==l&&(l=Array(5));null!=u&&(A=this.getBondOrder(u,k,j,h),null==this.prevSp2Atoms?l[s++]=this.prevAtom:s=2);var s=s+p,j=0,C=new JU.BS,v=r.size();if(e)for(z=0;z<v;z++){var y=r.get(z),t=y.getOtherAtomNode(b),D=t.getCovalentBondCount()-(d?0:t.getCovalentHydrogenCount()),E=y.getCovalentOrder();if(1==D&&(null!=
n||z<v-1))C.set(y.index);else if((1<E||D>j)&&!this.htRings.containsKey(JS.SmilesGenerator.getRingKey(t.getIndex(),k)))j=1<E?1E3+E:D,n=y}j=null==n?null:n.getOtherAtomNode(b);v=null==n?0:n.getCovalentOrder();if(h||2==v&&1<p||null!=j&&JS.SmilesSearch.isRingBond(this.ringSets,k,j.getIndex()))l=null;7>x&&null!=u&&(2==u.getCovalentOrder()&&2==v&&null!=this.prevSp2Atoms&&null!=this.prevSp2Atoms[1]?(w[x++]=this.prevSp2Atoms[0],w[x++]=this.prevSp2Atoms[1]):w[x++]=this.prevAtom);7>x&&1==p&&(w[x++]=B);B=1==
v&&null==this.prevSp2Atoms;y=this.getBondStereochemistry(u,this.prevAtom);if(null!=A||"\x00"!=y)"\x00"!=y&&(A=""+y),a.append(A);u=new JU.SB;D=x;E=s;for(z=0;z<r.size();z++)y=r.get(z),C.get(y.index)&&(t=y.getOtherAtomNode(b),y=new JU.SB,y.append("("),this.prevAtom=b,this.prevSp2Atoms=null,this.getSmilesAt(y,t,c,e,d,f),y.append(")"),0<=u.indexOf(y.toString())&&(x=10),u.appendSB(y),r.remove(z--),7>x&&(w[x++]=t),null!=l&&5>s&&(l[s++]=t));c=new JU.SB;var C=x,F=s;d=null;if(!e&&!this.noStereo&&null==this.stereoReference&&
(5==r.size()||6==r.size()))d=this.sortInorganic(b,r,this.vTemp);for(z=0;z<r.size();z++)y=r.get(z),y!==n&&(t=y.getOtherAtomNode(b),A=this.getBondOrder(y,k,t.getIndex(),h),B||(y=this.getBondStereochemistry(y,b),"\x00"!=y&&(A=""+y)),c.append(A),c.append(this.getRingCache(k,t.getIndex(),this.htRings)),7>x&&(w[x++]=t),null!=l&&5>s&&(l[s++]=t));D!=C&&C!=x&&this.swapArray(w,D,C,x);null!=l&&(E!=F&&F!=s)&&this.swapArray(l,E,F,s);if(m&&2==x&&2==v&&3==j.getCovalentBondCount()){t=j.getEdges();for(s=0;s<t.length;s++)t[s].isCovalent()&&
j.getBondedAtomIndex(s)!=k&&(w[x++]=this.atoms[j.getBondedAtomIndex(s)]);s=0}else null!=j&&7>x&&(w[x++]=j);e=b.getFormalCharge();m=b.getIsotopeNumber();r=b.getValence();z=this.openSMILES?b.getFloatProperty("property_atomclass"):0;t=b.getAtomName();y=G(b,JU.BNode)?b.getBioStructureTypeName():"";this.addAtomComment&&a.append("\n//* "+b.toString()+" *//\t");this.topologyOnly?a.append("*"):g&&0!=y.length&&0!=t.length?this.addBracketedBioName(a,b,"."+t,!1):a.append(JS.SmilesAtom.getAtomLabel(q,m,f?-1:
r,e,z,p,h,null!=d?d:this.noStereo?null:this.checkStereoPairs(b,k,w,x)));a.appendSB(c).appendSB(u);if(null==n)return null;null!=l&&2==v&&(1==s||2==s)?(null==l[0]&&(l[0]=b),null==l[1]&&(l[1]=b)):l=null;this.prevSp2Atoms=l;this.prevAtom=b;return j},"JU.SB,JU.Node,~B,~B,~B,~B");h(c$,"swapArray",function(a,b,c,e){b=c-b;if(null==this.atemp||this.atemp.length<b)this.atemp=Array(b);for(var d=b,f=c;0<d;)this.atemp[--d]=a[--f];for(f=c;f<e;f++)a[f-b]=a[f];d=b;for(f=e;0<d;)a[--f]=this.atemp[--d]},"~A,~N,~N,~N");
h(c$,"getBondOrder",function(a,b,c,e){a=a.getCovalentOrder();return!e||!this.bsAromatic.get(c)?JS.SmilesBond.getBondOrderString(a):1==a&&!this.isSameAromaticRing(b,c)?"-":""},"JU.Edge,~N,~N,~B");h(c$,"isSameAromaticRing",function(a,b){for(var c,e=this.aromaticRings.size();0<=--e;)if((c=this.aromaticRings.get(e)).get(a)&&c.get(b))return!0;return!1},"~N,~N");h(c$,"sortBonds",function(a,b,c){if(null==this.smilesStereo)try{this.smilesStereo=JS.SmilesStereo.newStereo(null)}catch(e){if(!F(e,JS.InvalidSmilesException))throw e;
}this.smilesStereo.sortBondsByStereo(a,b,c,a.getEdges(),this.vTemp.vA)},"JU.Node,JU.Node,JU.P3");h(c$,"sortInorganic",function(a,b,c){for(var e=a.getIndex(),d=b.size(),f=new JU.Lst,k=new JU.Lst,g,j,h=null,m=null,l,s,q=new JU.BS,p=null,n=Array(6),p=!0,w="",u=0,t=0;t<d;t++)if(l=b.get(t),n[0]=g=l.getOtherAtomNode(a),0==t?w=this.addStereoCheck(e,n,0,""):p&&null!=this.addStereoCheck(e,n,0,w)&&(p=!1),!q.get(t)){q.set(t);for(var B=!1,x=t+1;x<d;x++)if(!q.get(x)&&(s=b.get(x),j=s.getOtherAtomNode(a),JS.SmilesStereo.isDiaxial(a,
a,g,j,c,-0.95))){switch(++u){case 1:h=g;break;case 2:m=g;break;case 3:2==JS.SmilesStereo.getHandedness(m,h,g,a,c)&&(g=l,l=s,s=g)}f.addLast(L(-1,[l,s]));B=!0;q.set(x);break}B||k.addLast(l)}e=f.size();if(p||6==d&&3!=e||5==d&&0==e)return"";p=f.get(0);l=p[0];n[0]=l.getOtherAtomNode(a);b.clear();b.addLast(l);1<e&&k.addLast(f.get(1)[0]);3==e&&k.addLast(f.get(2)[0]);1<e&&k.addLast(f.get(1)[1]);3==e&&k.addLast(f.get(2)[1]);for(t=0;t<k.size();t++)l=k.get(t),b.addLast(l),n[t+1]=l.getOtherAtomNode(a);b.addLast(p[1]);
n[d-1]=p[1].getOtherAtomNode(a);return JS.SmilesStereo.getStereoFlag(a,n,d,c)},"JU.Node,JU.Lst,JS.VTemp");h(c$,"checkStereoPairs",function(a,b,c,e){if(4>e)return"";if(4==e&&6==a.getElementNumber())for(var d="",f=0;4>f;f++)if(null==(d=this.addStereoCheck(b,c,f,d))){e=10;break}return 6<e?"":JS.SmilesStereo.getStereoFlag(a,c,e,this.vTemp)},"JU.Node,~N,~A,~N");h(c$,"addStereoCheck",function(a,b,c,e){var d=b[c].getAtomicAndIsotopeNumber(),f=b[c].getCovalentBondCount(),k=6==d&&!this.explicitH?b[c].getCovalentHydrogenCount():
0;if(6==d?4!=f||3!=k:1<f)return e;d=";"+d+"/"+k+"/"+f+",";if(0<=e.indexOf(d)){if(3==k){for(d=k=0;d<f&&3>k;d++){var g=b[c].getBondedAtomIndex(d);g!=a&&(k+=this.atoms[g].getAtomicAndIsotopeNumber())}if(3<k)return e}return null}return e+d},"~N,~A,~N,~S");h(c$,"getRingCache",function(a,b,c){var e=JS.SmilesGenerator.getRingKey(a,b),d=c.get(e),f=null==d?null:d[0];if(null==f)this.bsRingKeys.set(++this.nPairs),this.nPairsMax=Math.max(this.nPairs,this.nPairsMax),c.put(e,L(-1,[f=this.getRingPointer(this.nPairs),
Integer.$valueOf(b),Integer.$valueOf(this.nPairs)])),JU.Logger.debugging&&JU.Logger.debug("adding for "+a+" ring key "+this.nPairs+": "+e);else{c.remove(e);a=d[2].intValue();this.bsRingKeys.clear(a);if(0>this.bsRingKeys.nextSetBit(0)&&(2==this.nPairsMax||99==this.nPairsMax))this.nPairsMax=this.nPairs=99==this.nPairsMax?10:0;JU.Logger.debugging&&JU.Logger.debug("using ring key "+e)}return f},"~N,~N,java.util.Map");h(c$,"getRingPointer",function(a){return 10>a?""+a:100>a?"%"+a:"%("+a+")"},"~N");h(c$,
"dumpRingKeys",function(a,b){JU.Logger.info(a.toString()+"\n\n");for(var c,e=b.keySet().iterator();e.hasNext()&&((c=e.next())||1);)JU.Logger.info("unmatched ring key: "+c)},"JU.SB,java.util.Map");c$.getRingKey=h(c$,"getRingKey",function(a,b){return Math.min(a,b)+"_"+Math.max(a,b)},"~N,~N")});v("JS");A(null,"JS.SmilesAromatic","java.util.Hashtable JU.BS $.Lst $.V3 JS.SmilesRing $.SmilesRingSet $.SmilesSearch JU.BSUtil $.Logger".split(" "),function(){c$=N(JS,"SmilesAromatic");c$.setAromatic=h(c$,"setAromatic",
function(a,b,c,e,d,f,k,g,j,h,m,l,s){k=k||0<f;if(s)for(B=e.size();0<=--B;){if(x=e.get(B),s=JS.SmilesAromatic.isSp2Ring(a,b,c,x,!g?3.4028235E38:0<f?0.1:0.01,0==f)){d.or(x);if(k){j=new JU.Lst;for(var n=x.nextSetBit(0);0<=n;n=x.nextSetBit(n+1))for(var p=b[n],r=p.getEdges(),w=p.getIndex(),u=r.length;0<=--u;){var t=r[u].getOtherAtomNode(p).getIndex();t>w&&x.get(t)&&j.addLast(r[u])}switch(JS.SmilesAromatic.checkHueckelAromatic(a,b,d,x,f,l)){case -1:continue;case 0:s=!1;case 1:if(null!=m&&m.addLast(new JS.SmilesRing(a,
x,j,s)),!s)continue}}h.addLast(x)}}else for(var B=e.size();0<=--B;){var x=JU.BSUtil.copy(e.get(B));x.and(d);x.cardinality()==a&&h.addLast(x)}},"~N,~A,JU.BS,JU.Lst,JU.BS,~N,~B,~B,JS.VTemp,JU.Lst,JU.Lst,~A,~B");c$.checkAromaticDefined=h(c$,"checkAromaticDefined",function(a,b,c){for(var e=b.nextSetBit(0);0<=e;e=b.nextSetBit(e+1))for(var d=a[e].getEdges(),f=0;f<d.length;f++)switch(d[f].order){case 515:case 514:case 513:c.set(d[f].getAtomIndex1()),c.set(d[f].getAtomIndex2())}},"~A,JU.BS,JU.BS");c$.isSp2Ring=
h(c$,"isSp2Ring",function(a,b,c,e,d,f){for(var k=e.nextSetBit(0);0<=k;k=e.nextSetBit(k+1)){var g=b[k],j=g.getEdges();if(3<j.length)return!1}if(3.4028235E38==d)return!0;0>=d&&(d=0.01);a=new JU.V3;for(var h=new JU.V3,m=new JU.V3,l=null,k=e.cardinality(),n=Array(2*k),q=0,p=1-5*d,k=e.nextSetBit(0);0<=k;k=e.nextSetBit(k+1)){for(var g=b[k],j=g.getEdges(),r=-1,w=-1,u=-1,j=j.length;0<=--j;){var t=g.getBondedAtomIndex(j);if(c.get(t))if(e.get(t))0>w?w=t:u=t;else{if(16==g.getElementNumber()){if(!f)return!1;
t=-1}r=t}}null==l&&(l=new JU.V3);j=0;for(g=k;2>j;j++){JS.SmilesSearch.getNormalThroughPoints(b[w],b[g],b[u],a,h,m);if(!JS.SmilesAromatic.addNormal(a,l,p))return!1;n[q++]=JU.V3.newV(a);if(0>(g=r))break}}return JS.SmilesAromatic.checkStandardDeviation(n,l,q,d)},"~N,~A,JU.BS,JU.BS,~N,~B");c$.addNormal=h(c$,"addNormal",function(a,b,c){var e=b.dot(a);if(0!=e&&Math.abs(e)<c)return!1;0>e&&a.scale(-1);b.add(a);b.normalize();return!0},"JU.V3,JU.V3,~N");c$.checkStandardDeviation=h(c$,"checkStandardDeviation",
function(a,b,c,e){for(var d=0,f=0,k=0;k<c;k++)var g=a[k].dot(b),d=d+g,f=f+g*g;d=Math.sqrt((f-d*d/c)/(c-1));return d<e},"~A,JU.V3,~N,~N");c$.checkHueckelAromatic=h(c$,"checkHueckelAromatic",function(a,b,c,e,d,f){for(var k=0,g=0,j=e.nextSetBit(0);0<=j&&0<=k;j=e.nextSetBit(j+1)){var h=b[j],m=h.getElementNumber(),l=h.getCovalentBondCount()+h.getMissingHydrogenCount()+h.getValence()-4;if(6==m){var n=h.getFormalCharge();-2147483648!=n&&(l+=n)}m=5<=m&&8>=m?m-5:15==m?2:34==m?3:33==m?4:16==m?5:-1;if(0<=m){m=
JS.SmilesAromatic.OS_PI_COUNTS[m];if(0>l||l>=m.length)return-1;switch(l=m[l]){case -2:return-1;case -1:m=h.getEdges();l=0;for(n=m.length;0<=--n;){var q=m[n];if(2==q.getCovalentOrder()){l=q.getOtherAtomNode(h);l=6==l.getElementNumber()||c.get(l.getIndex())?1:0<d?-100:0;break}}default:if(0>l)return-1;null!=f&&(f[j]=l);k+=l;1==l&&g++;JU.Logger.debugging&&JU.Logger.info("atom "+h+" pi="+l+" npi="+k)}}}return 0==(k-2)%4&&(2>d||5==a||6==g)?1:0},"~N,~A,JU.BS,JU.BS,~N,~A");c$.finalizeAromatic=h(c$,"finalizeAromatic",
function(a,b,c,e,d,f,k){k&&JS.SmilesAromatic.removeBridgingRings(c,e);JS.SmilesAromatic.checkFusedRings(e,d,c);b.clearAll();for(d=c.size();0<=--d;)b.or(c.get(d));if(k||f)for(d=b.nextSetBit(0);0<=d;d=b.nextSetBit(d+1)){c=a[d].getEdges();f=0;for(var g=c.length;0<=--g;){var j=c[g].getOtherAtomNode(a[d]),h=c[g].getCovalentOrder(),m=j.getIndex();if(b.get(m)){if(2==h){j=!1;for(h=e.size();0<=--h;){var l=e.get(h);if(l.get(d)&&l.get(m)){j=!0;break}}if(!j){f=-1;break}}f++}else if(k&&6==j.getElementNumber()&&
2==h){f=-1;break}}2>f&&(b.clear(d),d=-1)}},"~A,JU.BS,JU.Lst,JU.Lst,~A,~B,~B");c$.removeBridgingRings=h(c$,"removeBridgingRings",function(a,b){var c=new JU.BS,e=new JU.BS,d=new JU.BS;JS.SmilesAromatic.checkBridges(a,e,a,e,c);JS.SmilesAromatic.checkBridges(b,d,b,d,c);JS.SmilesAromatic.checkBridges(a,e,b,d,c);for(c=a.size();0<=--c;)e.get(c)&&a.remove(c);for(c=b.size();0<=--c;)d.get(c)&&b.remove(c)},"JU.Lst,JU.Lst");c$.checkBridges=h(c$,"checkBridges",function(a,b,c,e,d){for(var f=a===c,k=a.size();0<=
--k;)for(var g=a.get(k),j=f?k+1:0,h=c.size();--h>=j;){var m=c.get(h);m.equals(g)||(d.clearAll(),d.or(g),d.and(m),2<d.cardinality()&&(b.set(k),e.set(h)))}},"JU.Lst,JU.BS,JU.Lst,JU.BS,JU.BS");c$.checkFusedRings=h(c$,"checkFusedRings",function(a,b,c){for(var e=new java.util.Hashtable,d=a.size();0<=--d;){for(var f=a.get(d),k=f.edges,g=k.size();0<=--g;){var j=JS.SmilesRing.getSetByEdge(k.get(g),e);null==j||j===f.$set||(null!=f.$set?j.addSet(f.$set,e):j.addRing(f))}(null==f.$set?f.$set=new JS.SmilesRingSet:
f.$set).addRing(f);f.addEdges(e)}for(d=a.size();0<=--d;)if(!(f=a.get(d)).isOK&&!(null==(j=f.$set)||j.isEmpty())){if(2==j.getElectronCount(b)%4)for(g=j.size();0<=--g;)(f=j.get(g)).isOK||c.addLast(f);j.clear()}},"JU.Lst,~A,JU.Lst");H(c$,"OS_PI_COUNTS",L(-1,[w(-1,[-2,1,0]),w(-1,[1,2,1,-1]),w(-1,[2,1,2,1,1]),w(-1,[2,1]),w(-1,[-2,1,2,1,-2]),w(-1,[2,1,2,2])]))});v("JS");A(["JU.BS"],"JS.SmilesRing",null,function(){c$=D(function(){this.bsEdgesToCheck=this.edges=this.$set=null;this.isOK=!1;this.n=0;C(this,
arguments)},JS,"SmilesRing",JU.BS);E(c$,function(a,b,c,e){K(this,JS.SmilesRing,[]);this.or(b);this.edges=c;this.isOK=e;this.n=a},"~N,JU.BS,JU.Lst,~B");h(c$,"addEdges",function(a){for(var b=this.edges.size();0<=--b;)a.put(JS.SmilesRing.getKey(this.edges.get(b)),this.$set)},"java.util.Hashtable");c$.getSetByEdge=h(c$,"getSetByEdge",function(a,b){return b.get(JS.SmilesRing.getKey(a))},"JU.Edge,java.util.Hashtable");c$.getKey=h(c$,"getKey",function(a){var b=a.getAtomIndex1();a=a.getAtomIndex2();return b<
a?b+"_"+a:a+"_"+b},"JU.Edge")});v("JS");A(["JU.Lst","$.BS"],"JS.SmilesRingSet",null,function(){c$=D(function(){this.bs=null;C(this,arguments)},JS,"SmilesRingSet",JU.Lst);I(c$,function(){this.bs=new JU.BS});E(c$,function(){K(this,JS.SmilesRingSet,[])});h(c$,"addSet",function(a,b){for(var c=a.size();0<=--c;){var e=a.get(c);this.addRing(e);e.addEdges(b)}},"JS.SmilesRingSet,java.util.Hashtable");h(c$,"addRing",function(a){this.addLast(a);a.$set=this;this.bs.or(a)},"JS.SmilesRing");h(c$,"getElectronCount",
function(a){for(var b=0,c=this.bs.nextSetBit(0);0<=c;c=this.bs.nextSetBit(c+1))b+=a[c];return b},"~A")});v("JS");A(["JU.P3","JU.BNode"],"JS.SmilesAtom",["JU.AU","JU.Elements","$.Logger"],function(){c$=D(function(){this.atomsOr=null;this.nAtomsOr=0;this.primitives=null;this.index=this.nPrimitives=0;this.residueChar=this.residueName=this.referance=this.atomName=null;this.isBioResidue=this.isBioAtom=!1;this.bioType="\x00";this.$isLeadAtom=!1;this.notBondedIndex=-1;this.notCrossLinked=!1;this.aromaticAmbiguous=
!0;this.atomType=null;this.covalentHydrogenCount=-1;this.hasSymbol=this.selected=this.not=!1;this.isFirst=!0;this.jmolIndex=-1;this.elementNumber=-2;this.implicitHydrogenCount=this.explicitHydrogenCount=this.residueNumber=this.atomNumber=-2147483648;this.bonds=this.parent=null;this.iNested=this.bondCount=0;this.charge=this.atomicMass=-2147483648;this.matchingIndex=-1;this.stereo=null;this.$isAromatic=!1;this.atomSite=this.component=0;this.nonhydrogenDegree=this.degree=-1;this.valence=0;this.connectivity=
-1;this.ringSize=this.ringMembership=-2147483648;this.ringConnectivity=-1;this.matchingNode=null;this.hasSubpattern=!1;this.mapIndex=-1;this.atomClass=NaN;this.symbol=null;this.implicitHCount=0;C(this,arguments)},JS,"SmilesAtom",JU.P3,JU.BNode);I(c$,function(){this.bonds=Array(4)});c$.allowSmilesUnbracketed=h(c$,"allowSmilesUnbracketed",function(a){return 0<="B, C, N, O, P, S, F, Cl, Br, I, *,".indexOf(a+",")},"~S");E(c$,function(){K(this,JS.SmilesAtom,[])});h(c$,"getChiralClass",function(){return null==
this.stereo?0:this.stereo.chiralClass});h(c$,"isDefined",function(){return this.hasSubpattern||0!=this.iNested||this.isBioAtom||-2!=this.elementNumber||0<this.nAtomsOr||0<this.nPrimitives});h(c$,"setBioAtom",function(a){this.isBioAtom="\x00"!=a;this.bioType=a;null!=this.parent&&(this.parent.bioType=a,this.parent.isBioAtom=this.isBioAtom)},"~S");h(c$,"setAtomName",function(a){null!=a&&(0<a.length&&(this.atomName=a),a.equals("\x00")&&(this.$isLeadAtom=!0),null!=this.parent&&(this.parent.atomName=a))},
"~S");h(c$,"setBonds",function(a){this.bonds=a},"~A");h(c$,"appendAtomOr",function(a){null==this.atomsOr&&(this.atomsOr=Array(2));this.nAtomsOr>=this.atomsOr.length&&(this.atomsOr=JU.AU.doubleLength(this.atomsOr));a.setIndex(this.index);a.parent=this;return this.atomsOr[this.nAtomsOr++]=a},"JS.SmilesAtom");h(c$,"appendPrimitive",function(a){null==this.primitives&&(this.primitives=Array(2));this.nPrimitives>=this.primitives.length&&(this.primitives=JU.AU.doubleLength(this.primitives));a.setIndex(this.index);
a.parent=this;this.primitives[this.nPrimitives++]=a;this.setSymbol("*");this.hasSymbol=!1;return a},"JS.SmilesAtom");h(c$,"setIndex",function(a){this.index=a;return this},"~N");h(c$,"setAll",function(a,b,c,e){this.component=a;this.index=b;this.setSymbol(c);this.charge=e;return this},"~N,~N,~S,~N");h(c$,"setHydrogenCount",function(){if(-2147483648!=this.explicitHydrogenCount)return!0;var a=JS.SmilesAtom.getDefaultCount(this.elementNumber,this.$isAromatic);if(0>a)return-1==a;7==this.elementNumber&&
this.$isAromatic&&2==this.bondCount&&1==this.bonds[0].order&&1==this.bonds[1].order&&a++;for(var b=0;b<this.bondCount;b++)switch(this.bonds[b].order){case 81:7==this.elementNumber&&JU.Logger.info("Ambiguous bonding to aromatic N found -- MF may be in error");a-=1;break;case 1:case 257:case 513:a-=1;break;case 2:a-=this.$isAromatic&&6==this.elementNumber?1:2;break;case 3:a-=3}0<=a&&(this.explicitHydrogenCount=a);return!0});c$.getDefaultCount=h(c$,"getDefaultCount",function(a,b){switch(a){case 0:case -1:case -2:return-1;
case 6:return b?3:4;case 8:case 16:return 2;case 7:return b?2:3;case 5:case 15:return 3;case 9:case 17:case 35:case 53:return 1}return-2},"~N,~B");n(c$,"getIndex",function(){return this.index});h(c$,"isAromatic",function(){return this.$isAromatic});h(c$,"setSymbol",function(a){this.symbol=a;this.$isAromatic=a.equals(a.toLowerCase());this.hasSymbol=!0;if(a.equals("*"))return this.$isAromatic=!1,this.elementNumber=-2,!0;if(a.equals("Xx"))return this.elementNumber=0,!0;this.aromaticAmbiguous=!1;if(a.equals("a")||
a.equals("A"))return 0>this.elementNumber&&(this.elementNumber=-1),!0;this.$isAromatic&&(a=a.substring(0,1).toUpperCase()+(1==a.length?"":a.substring(1)));this.elementNumber=JU.Elements.elementNumberFromSymbol(a,!0);return 0!=this.elementNumber},"~S");n(c$,"getElementNumber",function(){return this.elementNumber});h(c$,"getAtomicMass",function(){return this.atomicMass});n(c$,"getAtomNumber",function(){return this.atomNumber});h(c$,"setAtomicMass",function(a){this.atomicMass=a},"~N");h(c$,"getCharge",
function(){return this.charge});h(c$,"setCharge",function(a){this.charge=a},"~N");h(c$,"getMatchingAtomIndex",function(){return this.matchingIndex});h(c$,"getMatchingAtom",function(){return this.matchingNode});h(c$,"setMatchingAtom",function(a,b){this.matchingNode=a;this.matchingIndex=b},"JU.Node,~N");h(c$,"setExplicitHydrogenCount",function(a){this.explicitHydrogenCount=a},"~N");h(c$,"setImplicitHydrogenCount",function(a){this.implicitHydrogenCount=a},"~N");h(c$,"setDegree",function(a){this.degree=
a},"~N");h(c$,"setNonhydrogenDegree",function(a){this.nonhydrogenDegree=a},"~N");h(c$,"setValence",function(a){this.valence=a},"~N");h(c$,"setConnectivity",function(a){this.connectivity=a},"~N");h(c$,"setRingMembership",function(a){this.ringMembership=a},"~N");h(c$,"setRingSize",function(a){this.ringSize=a},"~N");h(c$,"setRingConnectivity",function(a){this.ringConnectivity=a},"~N");n(c$,"getModelIndex",function(){return this.component});n(c$,"getAtomSite",function(){return this.atomSite});n(c$,"getImplicitHydrogenCount",
function(){return 0});h(c$,"getExplicitHydrogenCount",function(){return this.explicitHydrogenCount});n(c$,"getFormalCharge",function(){return this.charge});n(c$,"getIsotopeNumber",function(){return this.atomicMass});n(c$,"getAtomicAndIsotopeNumber",function(){return JU.Elements.getAtomicAndIsotopeNumber(this.elementNumber,this.atomicMass)});n(c$,"getAtomName",function(){return null==this.atomName?"":this.atomName});n(c$,"getGroup3",function(){return null==this.residueName?"":this.residueName},"~B");
n(c$,"getGroup1",function(){return null==this.residueChar?"":this.residueChar},"~S");h(c$,"addBond",function(a){this.bondCount>=this.bonds.length&&(this.bonds=JU.AU.doubleLength(this.bonds));this.bonds[this.bondCount]=a;this.bondCount++},"JS.SmilesBond");h(c$,"setBondArray",function(){this.bonds.length>this.bondCount&&(this.bonds=JU.AU.arrayCopyObject(this.bonds,this.bondCount));null!=this.atomsOr&&this.atomsOr.length>this.nAtomsOr&&(this.atomsOr=JU.AU.arrayCopyObject(this.atomsOr,this.atomsOr.length));
null!=this.primitives&&this.primitives.length>this.nPrimitives&&(this.primitives=JU.AU.arrayCopyObject(this.primitives,this.primitives.length));for(var a=0;a<this.bonds.length;a++)this.isBioAtom&&17==this.bonds[a].order&&(this.bonds[a].order=112),this.bonds[a].atom1.index>this.bonds[a].atom2.index&&this.bonds[a].switchAtoms()});n(c$,"getEdges",function(){return null!=this.parent?this.parent.getEdges():this.bonds});h(c$,"getBond",function(a){return null!=this.parent?this.parent.getBond(a):0<=a&&a<
this.bondCount?this.bonds[a]:null},"~N");n(c$,"getCovalentBondCount",function(){return this.getBondCount()});n(c$,"getBondCount",function(){return null!=this.parent?this.parent.getCovalentBondCount():this.bondCount+this.implicitHCount});h(c$,"getMatchingBondedAtom",function(a){if(null!=this.parent)return this.parent.getMatchingBondedAtom(a);if(a>=this.bondCount)return-1;a=this.bonds[a];return(a.atom1===this?a.atom2:a.atom1).matchingIndex},"~N");n(c$,"getBondedAtomIndex",function(a){return null!=this.parent?
this.parent.getBondedAtomIndex(a):this.bonds[a].getOtherAtom(this).index},"~N");n(c$,"getCovalentHydrogenCount",function(){if(0<=this.covalentHydrogenCount)return this.covalentHydrogenCount;if(null!=this.parent)return this.parent.getCovalentHydrogenCount();for(var a=this.covalentHydrogenCount=0;a<this.bonds.length;a++)1==this.bonds[a].getOtherAtom(this).elementNumber&&this.covalentHydrogenCount++;return this.covalentHydrogenCount});n(c$,"getValence",function(){if(null!=this.parent)return this.parent.getValence();
var a=this.valence;if(0>=a&&null!=this.bonds)for(var b=this.bonds.length;0<=--b;)a+=this.bonds[b].getValence();return this.valence=a});h(c$,"getBondTo",function(a){if(null!=this.parent)return this.parent.getBondTo(a);for(var b,c=0;c<this.bonds.length;c++)if(null!=(b=this.bonds[c]))if(null==a?b.atom2===this:b.getOtherAtom(this)===a)return b;return null},"JS.SmilesAtom");h(c$,"getBondNotTo",function(a,b){for(var c,e=0;e<this.bonds.length;e++)if(null!=(c=this.bonds[e])){var d=c.getOtherAtom(this);if(a!==
d&&(b||1!=d.elementNumber))return c}return null},"JS.SmilesAtom,~B");n(c$,"isLeadAtom",function(){return this.$isLeadAtom});n(c$,"getOffsetResidueAtom",function(a,b){if(this.isBioAtom){if(0==b)return this.index;for(var c=0;c<this.bonds.length;c++)if(this.bonds[c].getAtomIndex1()==this.index&&96==this.bonds[c].order)return this.bonds[c].getOtherAtom(this).index}return-1},"~S,~N");n(c$,"getGroupBits",function(a){a.set(this.index)},"JU.BS");n(c$,"isCrossLinked",function(a){return this.getBondTo(a).isHydrogen()},
"JU.BNode");n(c$,"getCrossLinkVector",function(a){for(var b=!1,c=0;c<this.bonds.length;c++)if(112==this.bonds[c].order){if(null==a)return!0;a.addLast(Integer.$valueOf(this.index));a.addLast(Integer.$valueOf(this.bonds[c].getOtherAtom(this).index));a.addLast(Integer.$valueOf(this.bonds[c].getOtherAtom(this).index));b=!0}return b},"JU.Lst,~B,~B");n(c$,"getBioStructureTypeName",function(){return null});n(c$,"getResno",function(){return this.residueNumber});n(c$,"getChainID",function(){return 0});n(c$,
"getChainIDStr",function(){return""});c$.getAtomLabel=h(c$,"getAtomLabel",function(a,b,c,e,d,f,k,g){var j=JU.Elements.elementSymbolFromNumber(a);k&&(j=j.toLowerCase(),6!=a&&(c=2147483647));return(2147483647==c||0!=b||0!=e||0!=d||null!=g&&0<g.length?-1:JS.SmilesAtom.getDefaultCount(a,!1))==c?j:"["+(0>=b?"":""+b)+j+(null==g?"":g)+(1<f?"H"+f:1==f?"H":"")+(0>e&&-2147483648!=e?""+e:0<e?"+"+e:"")+(0==d?"":":"+O(d))+"]"},"~N,~N,~N,~N,~N,~N,~B,~S");n(c$,"getBioSmilesType",function(){return this.bioType});
h(c$,"isNucleic",function(){return"n"==this.bioType||"r"==this.bioType||"d"==this.bioType});n(c$,"isPurine",function(){return null!=this.residueChar&&this.isNucleic()&&0<="AG".indexOf(this.residueChar)});n(c$,"isPyrimidine",function(){return null!=this.residueChar&&this.isNucleic()&&0<="CTUI".indexOf(this.residueChar)});n(c$,"isDeleted",function(){return!1});h(c$,"setAtomType",function(a){this.atomType=a},"~S");n(c$,"getAtomType",function(){return null==this.atomType?this.atomName:this.atomType});
n(c$,"findAtomsLike",function(){return null},"~S");n(c$,"toString",function(){var a=null!=this.residueChar||null!=this.residueName?(null==this.residueChar?this.residueName:this.residueChar)+"."+this.atomName:null!=this.atomName&&-2147483648!=this.atomNumber?null:-1==this.elementNumber?"A":-2==this.elementNumber?"*":JU.Elements.elementSymbolFromNumber(this.elementNumber);if(null==a)return this.atomName+" #"+this.atomNumber;this.$isAromatic&&(a=a.toLowerCase());return"["+a+"."+this.index+(0<=this.matchingIndex?
"("+this.matchingNode+")":"")+"]"});n(c$,"getFloatProperty",function(a){return"property_atomclass"===a?this.atomClass:NaN},"~S");n(c$,"getMissingHydrogenCount",function(){return this.explicitHydrogenCount});H(c$,"UNBRACKETED_SET","B, C, N, O, P, S, F, Cl, Br, I, *,")});v("JS");A(["JU.Edge"],"JS.SmilesBond",["JS.InvalidSmilesException"],function(){c$=D(function(){this.atom2=this.atom1=null;this.isNot=!1;this.primitives=this.matchingBond=null;this.nPrimitives=0;this.bondsOr=null;this.nBondsOr=0;this.isRingBond=
!1;C(this,arguments)},JS,"SmilesBond",JU.Edge);c$.getBondOrderString=h(c$,"getBondOrderString",function(a){switch(a){case 2:return"=";case 3:return"#";default:return""}},"~N");h(c$,"set",function(a){this.order=a.order;this.isNot=a.isNot;this.primitives=a.primitives;this.nPrimitives=a.nPrimitives;this.bondsOr=a.bondsOr;this.nBondsOr=a.nBondsOr},"JS.SmilesBond");h(c$,"addBondOr",function(){null==this.bondsOr&&(this.bondsOr=Array(2));if(this.nBondsOr>=this.bondsOr.length){var a=Array(2*this.bondsOr.length);
System.arraycopy(this.bondsOr,0,a,0,this.bondsOr.length);this.bondsOr=a}a=new JS.SmilesBond(null,null,-1,!1);this.bondsOr[this.nBondsOr]=a;this.nBondsOr++;return a});h(c$,"addPrimitive",function(){null==this.primitives&&(this.primitives=Array(2));if(this.nPrimitives>=this.primitives.length){var a=Array(2*this.primitives.length);System.arraycopy(this.primitives,0,a,0,this.primitives.length);this.primitives=a}a=new JS.SmilesBond(null,null,-1,!1);this.primitives[this.nPrimitives]=a;this.nPrimitives++;
return a});n(c$,"toString",function(){return this.atom1+" -"+(this.isNot?"!":"")+this.order+"- "+this.atom2});E(c$,function(a,b,c,e){K(this,JS.SmilesBond,[]);this.set2(c,e);this.set2a(a,b)},"JS.SmilesAtom,JS.SmilesAtom,~N,~B");h(c$,"set2",function(a,b){this.order=a;this.isNot=b},"~N,~B");h(c$,"set2a",function(a,b){null!=a&&(this.atom1=a,a.addBond(this));null!=b&&(this.atom2=b,b.isFirst=!1,b.addBond(this))},"JS.SmilesAtom,JS.SmilesAtom");h(c$,"setAtom2",function(a){this.atom2=a;null!=this.atom2&&(a.addBond(this),
this.isRingBond=!0)},"JS.SmilesAtom");c$.isBondType=h(c$,"isBondType",function(a,b,c){if(0>"-=#:/\\.+!,&;@~^'".indexOf(a))return!1;if(!b&&0>"-=#:/\\.~^'".indexOf(a))throw new JS.InvalidSmilesException("SMARTS bond type "+a+" not allowed in SMILES");return c&&"~"==a?!1:!0},"~S,~B,~B");c$.getBondTypeFromCode=h(c$,"getBondTypeFromCode",function(a){switch(a){case ".":return 0;case "-":return 1;case "=":return 2;case "#":return 3;case ":":return 17;case "/":return 257;case "\\":return 513;case "^":return 769;
case "'":return 1025;case "@":return 65;case "~":return 81;case "+":return 96}return-1},"~S");h(c$,"getBondType",function(){return this.order});h(c$,"getValence",function(){return this.order&7});h(c$,"getOtherAtom",function(a){return this.atom1===a?this.atom2:this.atom1},"JS.SmilesAtom");n(c$,"getAtomIndex1",function(){return this.atom1.index});n(c$,"getAtomIndex2",function(){return this.atom2.index});n(c$,"getCovalentOrder",function(){return this.order});n(c$,"getOtherAtomNode",function(a){return a===
this.atom1?this.atom2:a===this.atom2?this.atom1:null},"JU.Node");n(c$,"isCovalent",function(){return 112!=this.order});n(c$,"isHydrogen",function(){return 112==this.order});h(c$,"switchAtoms",function(){var a=this.atom1;this.atom1=this.atom2;this.atom2=a;switch(this.order){case 769:this.order=1025;break;case 1025:this.order=769;break;case 257:this.order=513;break;case 513:this.order=257}});H(c$,"TYPE_UNKNOWN",-1,"TYPE_NONE",0,"TYPE_SINGLE",1,"TYPE_DOUBLE",2,"TYPE_TRIPLE",3,"TYPE_AROMATIC",17,"TYPE_DIRECTIONAL_1",
257,"TYPE_DIRECTIONAL_2",513,"TYPE_ATROPISOMER_1",769,"TYPE_ATROPISOMER_2",1025,"TYPE_RING",65,"TYPE_ANY",81,"TYPE_BIO_SEQUENCE",96,"TYPE_BIO_CROSSLINK",112,"TYPE_MULTIPLE",999)});v("JS");A(null,"JS.SmilesMeasure",["JU.PT"],function(){c$=D(function(){this.search=null;this.index=this.type=this.nPoints=0;this.isNot=!1;this.points=this.minmax=this.indices=null;C(this,arguments)},JS,"SmilesMeasure");I(c$,function(){this.indices=w(4,0);this.points=Array(4)});E(c$,function(a,b,c,e,d){this.search=a;this.type=
Math.min(4,Math.max(c,2));this.index=b;this.isNot=e;this.minmax=d;for(a=d.length-2;0<=a;a-=2)d[a]>d[a+1]&&(b=d[a+1],d[a+1]=d[a],d[a]=b)},"JS.SmilesSearch,~N,~N,~B,~A");h(c$,"addPoint",function(a){if(this.nPoints==this.type)return!1;if(0==this.nPoints)for(var b=1;b<this.type;b++)this.indices[b]=a+b;this.indices[this.nPoints++]=a;return!0},"~N");h(c$,"check",function(){for(var a=0;a<this.type;a++){var b=this.search.patternAtoms[this.indices[a]].getMatchingAtomIndex();this.points[a]=this.search.jmolAtoms[b]}b=
0;switch(this.type){case 2:b=this.points[0].distance(this.points[1]);break;case 3:this.search.v.vA.sub2(this.points[0],this.points[1]);this.search.v.vB.sub2(this.points[2],this.points[1]);b=this.search.v.vA.angle(this.search.v.vB)/0.017453292;break;case 4:JS.SmilesMeasure.setTorsionData(this.points[0],this.points[1],this.points[2],this.points[3],this.search.v,!0),b=this.search.v.vTemp1.angle(this.search.v.vTemp2)/0.017453292*(0>this.search.v.vNorm2.dot(this.search.v.vNorm3)?1:-1)}for(a=this.minmax.length-
2;0<=a;a-=2)if(b>=this.minmax[a]&&b<=this.minmax[a+1])return!this.isNot;return this.isNot});c$.setTorsionData=h(c$,"setTorsionData",function(a,b,c,e,d,f){d.vTemp1.sub2(a,b);d.vTemp2.sub2(e,c);f&&(d.vNorm2.sub2(b,c),d.vNorm2.normalize(),d.vTemp1.cross(d.vTemp1,d.vNorm2),d.vTemp1.normalize(),d.vTemp2.cross(d.vTemp2,d.vNorm2),d.vTemp2.normalize(),d.vNorm3.cross(d.vTemp1,d.vTemp2))},"JU.P3,JU.P3,JU.P3,JU.P3,JS.VTemp,~B");n(c$,"toString",function(){for(var a="(."+"__dat".charAt(this.type)+this.index+":"+
JU.PT.toJSON(null,this.minmax)+") for",b=0;b<this.type;b++)a+=" "+(b>=this.nPoints?"?":""+this.indices[b]);return a});H(c$,"TYPES","__dat","radiansPerDegree",0.017453292519943295)});v("JS");A(["java.util.Hashtable"],"JS.SmilesParser","java.lang.Character $.Float JU.Lst $.PT $.SB JS.InvalidSmilesException $.SmilesAtom $.SmilesBond $.SmilesMeasure $.SmilesSearch $.SmilesStereo JU.Elements $.Logger".split(" "),function(){c$=D(function(){this.isBioSequence=this.isSmarts=!1;this.bioType="\x00";this.ringBonds=
null;this.branchLevel=this.braceCount=0;this.ignoreStereochemistry=!1;this.flags=0;this.atomRefs=this.htMeasures=null;C(this,arguments)},JS,"SmilesParser");I(c$,function(){this.ringBonds=new java.util.Hashtable;this.htMeasures=new java.util.Hashtable});c$.getMolecule=h(c$,"getMolecule",function(a,b){return(new JS.SmilesParser(b)).parse(a)},"~S,~B");E(c$,function(a){this.isSmarts=a},"~B");h(c$,"reset",function(){this.branchLevel=this.braceCount=0});h(c$,"parse",function(a){if(null==a)throw new JS.InvalidSmilesException("expression must not be null");
var b=new JS.SmilesSearch;0<=a.indexOf("$(select")&&(a=this.parseNested(b,a,"select"));var c=w(1,0);a=JS.SmilesParser.extractFlags(a,c);this.flags=c[0];this.ignoreStereochemistry=32==(this.flags&32);b.setFlags(this.flags);0<=a.indexOf("$")&&(a=this.parseVariables(a));this.isSmarts&&0<=a.indexOf("[$")&&(a=this.parseVariableLength(a));if(0<=a.indexOf("||")){a=JU.PT.split(a,"||");c="";b.subSearches=Array(a.length);for(var e=0;e<a.length;e++){var d="|"+a[e]+"|";0>c.indexOf(d)&&(b.subSearches[e]=this.getSearch(b,
a[e],this.flags),c+=d)}JU.Logger.info(c);return b}return this.getSearch(b,a,this.flags)},"~S");h(c$,"parseVariableLength",function(a){for(var b=new JU.SB,c=a.length-1,e=0,d=!1,f=0;f<c;f++)switch(a.charAt(f)){case "(":e++;break;case ")":e--;break;case "|":0<e&&(d=!0,"|"==a.charAt(f+1)&&(a=a.substring(0,f)+a.substring(f+1),c--))}if(0<=a.indexOf("||")){c=JU.PT.split(a,"||");for(f=0;f<c.length;f++)b.append("||").append(this.parseVariableLength(c[f]))}else{c=-1;e=w(1,0);for(f=null;0<=(c=a.indexOf("[$",
c+1));){var k=c,g=-2147483648,j=-2147483648,c=JS.SmilesParser.getDigits(a,c+2,e),g=e[0];-2147483648!=g&&"-"==JS.SmilesParser.getChar(a,c)&&(c=JS.SmilesParser.getDigits(a,c+1,e),j=e[0]);if("("==JS.SmilesParser.getChar(a,c)&&(f=JS.SmilesParser.getSubPattern(a,k,"["),f.endsWith(")"))){var h=k+f.length+2,m=JS.SmilesParser.getSubPattern(a,c,"("),l=c;JS.SmilesParser.getSubPattern(a,c,"[");c+=1+m.length;if(0<=m.indexOf(":")&&0>m.indexOf("|")){for(var n=0,q=m.length,p=-1,f=0;f<q;f++)switch(m.charAt(f)){case "[":case "(":n++;
break;case ")":case "]":n--;break;case ".":0<=p&&0==n&&(q=f);break;case ":":0>p&&0==n&&(p=f)}0<p&&(m=m.substring(0,p)+"("+m.substring(p,q)+")"+m.substring(q))}if(-2147483648==g){if(f=m.indexOf("|"),0<=f)return this.parseVariableLength(a.substring(0,k)+"[$1"+a.substring(l,l+f+1)+")]"+a.substring(h)+"||"+a.substring(0,k)+"[$1("+a.substring(l+f+2)+a.substring(h))}else{-2147483648==j&&(j=g);0<=m.indexOf("|")&&(m="[$("+m+")]");for(f=g;f<=j;f++){g=new JU.SB;g.append("||").append(a.substring(0,k));for(l=
0;l<f;l++)g.append(m);g.append(a.substring(h));b.appendSB(g)}}}}}return d?this.parseVariableLength(b.substring(2)):2>b.length()?a:b.substring(2)},"~S");h(c$,"getSearch",function(a,b,c){this.htMeasures=new java.util.Hashtable;var e=new JS.SmilesSearch;e.setTop(a);e.isSmarts=this.isSmarts;e.pattern=b;e.setFlags(c);0<=b.indexOf("$(")&&(b=this.parseNested(e,b,""));this.parseSmiles(e,b,null,!1);if(0!=this.braceCount)throw new JS.InvalidSmilesException("unmatched '{'");if(!this.ringBonds.isEmpty())throw new JS.InvalidSmilesException("Open ring");
e.setAtomArray();e.isTopology=!0;e.patternAromatic=!1;for(a=e.ac;0<=--a;)if(b=e.patternAtoms[a],e.isTopology&&b.isDefined()&&(e.isTopology=!1),b.isAromatic()&&(e.patternAromatic=!0),b.setBondArray(),!this.isSmarts&&"\x00"==b.bioType&&!b.setHydrogenCount())throw new JS.InvalidSmilesException("unbracketed atoms must be one of: B, C, N, O, P, S, F, Cl, Br, I, *,");if(this.isSmarts)for(a=e.ac;0<=--a;){b=e.patternAtoms[a];this.checkNested(e,b,c);for(var d=0;d<b.nAtomsOr;d++)this.checkNested(e,b.atomsOr[d],
c);for(d=0;d<b.nPrimitives;d++)this.checkNested(e,b.primitives[d],c)}!this.isSmarts&&!this.isBioSequence&&(e.elementCounts[1]=e.getMissingHydrogenCount());this.fixChirality(e);return e},"JS.SmilesSearch,~S,~N");h(c$,"checkNested",function(a,b,c){if(0<b.iNested){var e=a.getNested(b.iNested);G(e,String)&&!e.startsWith("select")&&("~"!=e.charAt(0)&&"\x00"!=b.bioType&&(e="~"+b.bioType+"~"+e),c=this.getSearch(a,e,c),0<c.ac&&c.patternAtoms[0].selected&&(b.selected=!0),a.setNested(b.iNested,c))}},"JS.SmilesSearch,JS.SmilesAtom,~N");
h(c$,"fixChirality",function(a){for(var b=a.ac;0<=--b;){var c=a.patternAtoms[b];null!=c.stereo&&!this.ignoreStereochemistry&&c.stereo.fixStereo(c)}},"JS.SmilesSearch");h(c$,"parseSmiles",function(a,b,c,e){for(var d=w(1,0),f=0,k,g=null;null!=b&&0!=b.length;){var j=0;if(null==c||null!=g&&0==g.order)j=this.checkBioType(b,0),j==b.length&&(b+="*"),this.isBioSequence&&(a.needAromatic=a.top.needAromatic=!1);k=JS.SmilesParser.getChar(b,j);var h=this.checkBrace(a,k,"{");h&&(k=JS.SmilesParser.getChar(b,++j));
if("("==k){e=JS.SmilesParser.getSubPattern(b,j,"(");if(0<e.length&&JU.PT.isDigit(e.charAt(0))){if(JS.SmilesParser.getDigits(e,0,d)==e.length&&0<d[0]){var m,j=d[0]-1;if(0>j||j>=a.patternAtoms.length||null==(m=a.patternAtoms[j])||m===c||null!=m.getBondTo(c))throw new JS.InvalidSmilesException("Improper direct atom reference ("+e+").");null!=g&&-1!=g.order&&0!=g.order?g.set2a(null,m):new JS.SmilesBond(m,c,-1,!1)}}else{j="."==JS.SmilesParser.getChar(b,j+1);if(null==c)throw new JS.InvalidSmilesException("No previous atom for "+
(j?"measure":"branch"));e.startsWith(".")?this.parseMeasure(a,e.substring(1),c):0==e.length&&this.isBioSequence?c.notCrossLinked=!0:(this.branchLevel++,this.parseSmiles(a,e,c,!0),this.branchLevel--)}j=e.length+2}else{for(f=j;JS.SmilesBond.isBondType(k,this.isSmarts,this.isBioSequence);)k=JS.SmilesParser.getChar(b,++j);g=this.parseBond(a,null,b.substring(f,j),null,c,!1,e);h&&-1!=g.order&&(j=f);k=JS.SmilesParser.getChar(b,j);this.checkBrace(a,k,"{")&&(k=JS.SmilesParser.getChar(b,++j));"~"==k&&0==g.order&&
(j=this.checkBioType(b,j),j==b.length&&(b+="*"));if("\x00"==k&&0==g.order)break;f=JU.PT.isDigit(k)||"%"==k;h=!f&&("_"==k||"["==k||"*"==k||JU.PT.isLetter(k));if(f)j=JS.SmilesParser.getRingNumber(b,j,k,d),this.parseRing(a,d[0],c,g),g=null;else if(h)switch(k){case "[":case "_":f=JS.SmilesParser.getSubPattern(b,j,k);j+=f.length+("["==k?2:0);this.isBioSequence&&("["==k&&0>f.indexOf(".")&&0>f.indexOf("_"))&&(f+=".0");c=this.parseAtom(a,null,f,c,g,"["==k,!1,e);c.hasSubpattern=!0;-1!=g.order&&0!=g.order&&
g.set2a(null,c);g=null;break;default:f=!this.isBioSequence&&JU.PT.isUpperCase(k)?JS.SmilesParser.getChar(b,j+1):"\x00";if("X"!=k||"x"!=f)if(!JU.PT.isLowerCase(f)||0==JU.Elements.elementNumberFromSymbol(b.substring(j,j+2),!0))f="\x00";"\x00"!=f&&0<="NA CA BA PA SC AC".indexOf(b.substring(j,j+2))&&(f="\x00");k=JU.PT.isUpperCase(k)&&JU.PT.isLowerCase(f)?2:1;c=this.parseAtom(a,null,b.substring(j,j+k),c,g,!1,!1,e);g=null;j+=k}else if("("!=k)throw new JS.InvalidSmilesException("Unexpected character: "+
JS.SmilesParser.getChar(b,j));}k=JS.SmilesParser.getChar(b,j);"}"==k&&this.checkBrace(a,k,"}")&&j++;b=b.substring(j);e=!1}},"JS.SmilesSearch,~S,JS.SmilesAtom,~B");c$.getRingNumber=h(c$,"getRingNumber",function(a,b,c,e){switch(c){case "%":if("("==JS.SmilesParser.getChar(a,b+1)){if(a=JS.SmilesParser.getSubPattern(a,b+1,"("),JS.SmilesParser.getDigits(a,0,e),b+=a.length+3,0>e[0])throw new JS.InvalidSmilesException("Invalid number designation: "+a);}else if(b+3<=a.length&&(b=JS.SmilesParser.getDigits(a.substring(0,
b+3),b+1,e)),10>e[0])throw new JS.InvalidSmilesException("Two digits must follow the % sign");a=e[0];break;default:a=c.charCodeAt(0)-48,b++}e[0]=a;return b},"~S,~N,~S,~A");h(c$,"checkBioType",function(a,b){if(this.isBioSequence="~"==a.charAt(b)){b++;this.bioType="*";var c=JS.SmilesParser.getChar(a,2);if("~"==c&&("*"==(c=a.charAt(1))||JU.PT.isLowerCase(c)))this.bioType=c,b=3}return b},"~S,~N");h(c$,"parseMeasure",function(a,b,c){for(var e=b.indexOf(":"),d=0>e?b:b.substring(0,e);0!=e;){var f=d.length;
1==f&&(d+="0");var k=this.htMeasures.get(d);if(null==k==0>e||0==f)break;try{if(0<e){var g="__dat".indexOf(d.charAt(0));if(2>g)break;var j=w(1,0);JS.SmilesParser.getDigits(d,1,j);var h=j[0];b=b.substring(e+1);var m=b.startsWith("!");m&&(b=b.substring(1));var l=b.startsWith("-");l&&(b=b.substring(1));b=JU.PT.rep(b,"-",",");b=JU.PT.rep(b,",,",",-");l&&(b="-"+b);var n=JU.PT.split(b,",");if(1==n.length%2)break;for(var q=M(n.length,0),p=n.length;0<=--p&&!Float.isNaN(q[p]=JU.PT.fVal(n[p])););if(0<=p)break;
k=new JS.SmilesMeasure(a,h,g,m,q);a.measures.addLast(k);0<h?this.htMeasures.put(d,k):0==h&&JU.Logger.debugging&&JU.Logger.debug("measure created: "+k)}else{if(!k.addPoint(c.index))break;k.nPoints==k.type&&(this.htMeasures.remove(d),JU.Logger.debugging&&JU.Logger.debug("measure created: "+k));return}if(!k.addPoint(c.index))break}catch(r){if(F(r,NumberFormatException))break;else throw r;}return}throw new JS.InvalidSmilesException("invalid measure: "+b);},"JS.SmilesSearch,~S,JS.SmilesAtom");h(c$,"checkBrace",
function(a,b,c){switch(b){case "{":if(b!=c)break;this.braceCount++;return a.top.haveSelected=!0;case "}":if(b!=c)break;if(0<this.braceCount)return this.braceCount--,!0;break;default:return!1}throw new JS.InvalidSmilesException("Unmatched '}'");},"JS.SmilesSearch,~S,~S");h(c$,"parseNested",function(a,b,c){var e;for(c="$("+c;0<=(e=b.lastIndexOf(c));){var d=JS.SmilesParser.getSubPattern(b,e+1,"("),f=e+d.length+3;b=b.substring(0,e)+"_"+a.addNested(d)+"_"+b.substring(f)}return b},"JS.SmilesSearch,~S,~S");
h(c$,"parseVariables",function(a){var b=new JU.Lst,c=new JU.Lst,e,d=0,f=-1;for(JU.Logger.debugging&&JU.Logger.info(a);0<=(e=a.indexOf("$",d))&&"("!=JS.SmilesParser.getChar(a,d+1);){d=JS.SmilesParser.skipTo(a,e,"=");if(d<=e+1||'"'!=JS.SmilesParser.getChar(a,d+1))break;e=a.substring(e,d);if(0<e.lastIndexOf("$")||0<e.indexOf("]"))throw new JS.InvalidSmilesException("Invalid variable name: "+e);f=JS.SmilesParser.getSubPattern(a,d+1,'"');b.addLast("["+e+"]");c.addLast(f);d+=f.length+2;d=JS.SmilesParser.skipTo(a,
d,";");f=++d}if(0>f)return a;a=a.substring(f);for(d=b.size();0<=--d;)e=b.get(d),f=c.get(d),f.equals(e)||(a=JU.PT.rep(a,e,f));JU.Logger.debugging&&JU.Logger.info(a);return a},"~S");h(c$,"parseAtom",function(a,b,c,e,d,f,k,g){if(null==c||0==c.length)throw new JS.InvalidSmilesException("Empty atom definition");var j=new JS.SmilesAtom;null==b&&a.appendAtom(j);if(!this.checkLogic(a,c,j,null,e,k,g)){var h=w(1,0);this.isBioSequence&&1==c.length&&(c+=".0");var m=c.charAt(0),l=0,n=!1;if(this.isSmarts&&"!"==
m){m=JS.SmilesParser.getChar(c,++l);if("\x00"==m)throw new JS.InvalidSmilesException("invalid '!'");j.not=n=!0}var q=c.indexOf("."),p=c.indexOf("@");if(0<=q&&(0>p||q<p)){j.isBioResidue=!0;m=c.substring(l,q);c=c.substring(q+1).toUpperCase();if(0<=(q=m.indexOf("#")))JS.SmilesParser.getDigits(m,q+1,h),m=m.substring(0,q),j.residueNumber=h[0];0==m.length&&(m="*");1<m.length?j.residueName=m.toUpperCase():m.equals("*")||(j.residueChar=m);m=c;if(0<=(q=m.indexOf("#")))JS.SmilesParser.getDigits(m,q+1,h),j.elementNumber=
h[0],m=m.substring(0,q);0==m.length?m="*":m.equals("0")&&(m="\x00");m.equals("*")||j.setAtomName(m);m="\x00"}j.setBioAtom(this.bioType);for(q=-2147483648;"\x00"!=m;){j.setAtomName(this.isBioSequence?"\x00":"");if(JU.PT.isDigit(m)){l=JS.SmilesParser.getDigits(c,l,h);m=h[0];if(-2147483648==m)throw new JS.InvalidSmilesException("Non numeric atomic mass");"?"==JS.SmilesParser.getChar(c,l)&&(l++,m=-m);j.setAtomicMass(m)}else switch(m){case '"':m=JU.PT.getQuotedStringAt(c,l);l+=m.length+2;j.setAtomType(m);
break;case "_":l=JS.SmilesParser.getDigits(c,l+1,h)+1;if(-2147483648==h[0])throw new JS.InvalidSmilesException("Invalid SEARCH primitive: "+c.substring(l));j.iNested=h[0];if(this.isBioSequence&&f&&l!=c.length)throw new JS.InvalidSmilesException("invalid characters: "+c.substring(l));break;case "=":l=JS.SmilesParser.getDigits(c,l+1,h);j.jmolIndex=h[0];break;case "#":m="-"==c.charAt(l+1);l=JS.SmilesParser.getDigits(c,l+(m?2:1),h);m?j.atomNumber=h[0]:j.elementNumber=h[0];break;case "-":case "+":l=this.checkCharge(c,
l,j);break;case "@":null==a.stereo&&(a.stereo=JS.SmilesStereo.newStereo(null));l=JS.SmilesStereo.checkChirality(c,l,a.patternAtoms[j.index]);break;case ":":l=JS.SmilesParser.getDigits(c,l+1,h);j.atomClass=h[0];break;default:var p=JS.SmilesParser.getChar(c,l+1),r=c.substring(l+1,l+(JU.PT.isLowerCase(p)&&(!f||!JU.PT.isDigit(JS.SmilesParser.getChar(c,l+2)))?2:1)),v=Character.toUpperCase(m)+r,u=!0;f&&JU.PT.isLetter(m)&&(!n&&(k?b:j).hasSymbol?u=!1:"H"==m?u=!JU.PT.isDigit(p)||"?"==JS.SmilesParser.getChar(c,
l+2):0<="DdhRrvXx".indexOf(m)&&JU.PT.isDigit(p)?u=!1:!v.equals("A")&&!v.equals("Xx")&&(u=0<JU.Elements.elementNumberFromSymbol(v,!0),!u&&""!==r&&(r="",v=v.substring(0,1),u=0<JU.Elements.elementNumberFromSymbol(v,!0))));if(u){if(!f&&!this.isSmarts&&!this.isBioSequence&&!JS.SmilesAtom.allowSmilesUnbracketed(v)||!j.setSymbol(v=m+r))throw new JS.InvalidSmilesException("Invalid atom symbol: "+v);k&&(b.hasSymbol=!0);l+=v.length}else switch(l=JS.SmilesParser.getDigits(c,l+1,h),p=h[0],m){default:throw new JS.InvalidSmilesException("Invalid SEARCH primitive: "+
c.substring(l));case "D":j.setDegree(-2147483648==p?1:p);break;case "d":j.setNonhydrogenDegree(-2147483648==p?1:p);break;case "H":q=-2147483648==p?1:p;break;case "h":j.setImplicitHydrogenCount(-2147483648==p?-1:p);break;case "R":-2147483648==p&&(p=-1);j.setRingMembership(p);a.top.needRingData=!0;break;case "r":if(-2147483648==p)p=-1,j.setRingMembership(p);else{j.setRingSize(p);switch(p){case 500:p=5;break;case 600:p=6}p>a.ringDataMax&&(a.ringDataMax=p)}a.top.needRingData=!0;break;case "v":j.setValence(-2147483648==
p?1:p);break;case "X":j.setConnectivity(-2147483648==p?1:p);break;case "x":j.setRingConnectivity(-2147483648==p?-1:p),a.top.needRingData=!0}}m=JS.SmilesParser.getChar(c,l);if(n&&"\x00"!=m)throw new JS.InvalidSmilesException("'!' may only involve one primitive.");}-2147483648==q&&f&&(q=-2147483647);j.setExplicitHydrogenCount(q);a.patternAtoms[j.index].setExplicitHydrogenCount(q)}0<this.braceCount&&(j.selected=!0);null!=b&&(k?b.appendPrimitive(j):b.appendAtomOr(j));null!=e&&0==d.order&&(j.notBondedIndex=
e.index);null!=e&&0!=d.order&&(-1==d.order&&(d.order=this.isBioSequence&&g?112:this.isSmarts||e.isAromatic()&&j.isAromatic()?81:1),f||d.set2a(null,j),0==this.branchLevel&&(17==d.order||112==d.order)&&this.branchLevel++);0==this.branchLevel&&(a.lastChainAtom=j);return j},"JS.SmilesSearch,JS.SmilesAtom,~S,JS.SmilesAtom,JS.SmilesBond,~B,~B,~B");h(c$,"parseRing",function(a,b,c,e){b=Integer.$valueOf(b);var d=this.ringBonds.get(b);if(null==d)this.ringBonds.put(b,e),a.top.ringCount++;else{this.ringBonds.remove(b);
switch(e.order){case -1:e.order=-1!=d.order?d.order:this.isSmarts||c.isAromatic()&&d.atom1.isAromatic()?81:1;break;case 257:e.order=513;break;case 513:e.order=257}if(-1!=d.order&&d.order!=e.order||c===d.atom1||null!=d.atom1.getBondTo(c))throw new JS.InvalidSmilesException("Bad connection type or atom");d.set(e);c.bondCount--;d.setAtom2(c)}},"JS.SmilesSearch,~N,JS.SmilesAtom,JS.SmilesBond");h(c$,"checkCharge",function(a,b,c){var e=a.length,d=a.charAt(b),f=1;++b;if(b<e){var h=a.charAt(b);if(JU.PT.isDigit(h)){if(e=
w(1,0),b=JS.SmilesParser.getDigits(a,b,e),f=e[0],-2147483648==f)throw new JS.InvalidSmilesException("Non numeric charge");}else for(;b<e&&a.charAt(b)==d;)b++,f++}c.setCharge("+"==d?f:-f);return b},"~S,~N,JS.SmilesAtom");h(c$,"parseBond",function(a,b,c,e,d,f,h){var g=JS.SmilesParser.getChar(c,0);if("."==g){if(null!=e||null!=b)throw new JS.InvalidSmilesException("invalid '.'");this.isBioSequence="~"==JS.SmilesParser.getChar(c,1);return new JS.SmilesBond(null,null,0,!1)}if("+"==g&&null!=b)throw new JS.InvalidSmilesException("invalid '+'");
e=null==b?null==e?new JS.SmilesBond(d,null,this.isBioSequence&&null!=d?h?112:96:-1,!1):e:f?b.addPrimitive():b.addBondOr();if("\x00"!=g&&!this.checkLogic(a,c,null,e,d,f,!1)){if(f="!"==g)if(g=JS.SmilesParser.getChar(c,1),"\x00"==g||"!"==g)throw new JS.InvalidSmilesException("invalid '!'");c=JS.SmilesBond.getBondTypeFromCode(g);65==c&&(a.top.needRingMemberships=!0);if(null==d&&0!=c)throw new JS.InvalidSmilesException("Bond without a previous atom");switch(c){case 769:case 1025:f&&(f=!1,c=769==c?1025:
769);a.haveBondStereochemistry=!0;break;case 257:case 513:a.haveBondStereochemistry=!0;break;case 2:a.top.nDouble++;case 1:d.isAromatic()&&(a.top.needRingData=!0)}e.set2(c,f);this.isBioSequence&&null!=b&&b.set2(c,f)}return e},"JS.SmilesSearch,JS.SmilesBond,~S,JS.SmilesBond,JS.SmilesAtom,~B,~B");h(c$,"checkLogic",function(a,b,c,e,d,f,h){for(var g=b.indexOf(","),j=b.length;;){var n=0<g;if(n&&!this.isSmarts||0==g)break;var m="",g=b.indexOf(";");if(0<=g){if(!this.isSmarts||0==g)break;m="&"+b.substring(g+
1);b=b.substring(0,g);n||(b+=m,m="")}var l=0;if(n)for(b+=",";0<(g=b.indexOf(",",l))&&g<=j;){l=b.substring(l,g)+m;if(0==l.length)throw new JS.InvalidSmilesException("missing "+(null==e?"atom":"bond")+" token");null==e?this.parseAtom(a,c,l,null,null,!0,!1,h):this.parseBond(a,e,l,null,d,!1,!1);l=g+1}else if(0<=(g=b.indexOf("&"))||null!=e&&1<j&&!f){if(!this.isSmarts||0==g)break;if(null!=e&&0>g&&1<j){f=new JU.SB;for(n=0;n<j;){var s=b.charAt(n++);f.appendC(s);"!"!=s&&n<j&&f.appendC("&")}b=f.toString();
j=b.length}for(b+="&";0<(g=b.indexOf("&",l))&&g<=j;)l=b.substring(l,g)+m,null==e?this.parseAtom(a,c,l,null,null,!0,!0,h):this.parseBond(a,e,l,null,d,!0,!1),l=g+1}else return!1;return!0}s=b.charAt(g);throw new JS.InvalidSmilesException((this.isSmarts?"invalid placement for '"+s+"'":"["+s+"] notation only valid with SMARTS, not SMILES,")+" in "+b);},"JS.SmilesSearch,~S,JS.SmilesAtom,JS.SmilesBond,JS.SmilesAtom,~B,~B");c$.getSubPattern=h(c$,"getSubPattern",function(a,b,c){var e,d=1;switch(c){case "[":e=
"]";break;case '"':case "%":case "/":e=c;break;case "(":e=")";break;default:e=c,d=0}for(var f=a.length,h=1,g=b+1;g<f;g++){var j=a.charAt(g);if(j==e){if(h--,0==h)return a.substring(b+d,g+1-d)}else j==c&&h++}throw new JS.InvalidSmilesException("Unmatched "+c);},"~S,~N,~S");c$.getChar=h(c$,"getChar",function(a,b){return b<a.length?a.charAt(b):"\x00"},"~S,~N");c$.getDigits=h(c$,"getDigits",function(a,b,c){for(var e=b,d=a.length;e<d&&JU.PT.isDigit(a.charAt(e));)e++;try{c[0]=Integer.parseInt(a.substring(b,
e))}catch(f){if(F(f,NumberFormatException))c[0]=-2147483648;else throw f;}return e},"~S,~N,~A");c$.skipTo=h(c$,"skipTo",function(a,b,c){for(var e;(e=JS.SmilesParser.getChar(a,++b))!=c&&"\x00"!=e;);return"\x00"==e?-1:b},"~S,~N,~S");c$.cleanPattern=h(c$,"cleanPattern",function(a){a=JU.PT.replaceAllCharacters(a," \t\n\r","");a=JU.PT.rep(a,"^^","'");for(var b=0,c=0;0<=(b=a.indexOf("//*"))&&(c=a.indexOf("*//"))>=b;)a=a.substring(0,b)+a.substring(c+3);return a=JU.PT.rep(a,"//","")},"~S");c$.extractFlags=
h(c$,"extractFlags",function(a,b){a=JS.SmilesParser.cleanPattern(a);for(var c=0;a.startsWith("/");){var e=JS.SmilesParser.getSubPattern(a,0,"/").toUpperCase();a=a.substring(e.length+2);c=JS.SmilesSearch.addFlags(c,e)}b[0]=c;return a},"~S,~A");c$.getFlags=h(c$,"getFlags",function(a){var b=w(1,0);JS.SmilesParser.extractFlags(a,b);return b[0]},"~S")});v("JS");A(null,"JS.SmilesExt","java.lang.Float JU.AU $.BS $.Lst $.M4 $.Measure $.P3 J.api.Interface JU.Logger".split(" "),function(){c$=D(function(){this.sm=
this.e=null;C(this,arguments)},JS,"SmilesExt");E(c$,function(){});h(c$,"init",function(a){this.e=a;this.sm=this.e.vwr.getSmilesMatcher();return this},"~O");h(c$,"getSmilesCorrelation",function(a,b,c,e,d,f,h,g,j,n,m,l){var s=null==j?0.1:3.4028235E38;try{null==e&&(e=new JU.Lst,d=new JU.Lst);var q=new JU.M4,p=new JU.P3,r=this.e.vwr.ms.at,w=this.e.vwr.ms.ac,u=this.sm.getCorrelationMaps(c,r,w,a,l|32);null==u&&this.e.evalError(this.sm.getLastException(),null);if(0==u.length)return NaN;var t=u[0];for(a=
0;a<t.length;a++)e.addLast(r[t[a]]);u=this.sm.getCorrelationMaps(c,r,w,b,l);null==u&&this.e.evalError(this.sm.getLastException(),null);if(0==u.length)return NaN;JU.Logger.info(u.length+" mappings found");if(m||!g){b=3.4028235E38;c=null;for(a=0;a<u.length;a++){d.clear();for(var v=0;v<u[a].length;v++)d.addLast(r[u[a][v]]);J.api.Interface.getInterface("JU.Eigen",this.e.vwr,"script");var x=1==d.size()?0:JU.Measure.getTransformMatrix4(e,d,q,null);JU.Logger.info("getSmilesCorrelation stddev="+x);if(null!=
h&&x<s){for(var A=new JU.BS,v=0;v<u[a].length;v++)A.set(u[a][v]);h.addLast(A)}x<b&&(c=u[a],null!=f&&f.setM4(q),null!=n&&n.setT(p),b=x)}null!=j&&(j[0]=t,j[1]=c);d.clear();for(a=0;a<c.length;a++)d.addLast(r[c[a]]);return b}for(a=0;a<u.length;a++)for(v=0;v<u[a].length;v++)d.addLast(r[u[a][v]])}catch(z){if(F(z,Exception))this.e.evalError(z.getMessage(),null);else throw z;}return 0},"JU.BS,JU.BS,~S,JU.Lst,JU.Lst,JU.M4,JU.Lst,~B,~A,JU.P3,~B,~N");h(c$,"getSmilesMatches",function(a,b,c,e,d,f,h){if(0==a.length||
a.endsWith("///")||a.equals("H")||a.equals("*")||a.equalsIgnoreCase("NOAROMATIC"))try{return this.e.vwr.getSmilesOpt(c,0,0,d|(a.equals("H")?4096:0)|(a.equals("*")?8192:0)|(a.equalsIgnoreCase("NOAROMATIC")?16384:0),a.endsWith("///")?a:null)}catch(g){if(F(g,Exception))this.e.evalError(g.getMessage(),null);else throw g;}var j;if(null==e){e=2==(d&2);try{if(null==b)j=this.sm.getSubstructureSetArray(a,this.e.vwr.ms.at,this.e.vwr.ms.ac,c,null,d);else{var n=this.sm.find(a,b,e,h);if(!f)return!h?n:0==n.length?
w(0,0):n[0];var m=new JU.BS;for(f=0;f<n.length;f++)for(var l=n[f],s=l.length;0<=--s;)m.set(l[s]);if(!e)return w(m.cardinality(),0);var q=w(m.cardinality(),0);f=0;for(var p=m.nextSetBit(0);0<=p;p=m.nextSetBit(p+1))q[f++]=p;return q}}catch(r){if(F(r,Exception))return this.e.evalError(r.getMessage(),null),null;throw r;}}else{j=new JU.Lst;m=this.getSmilesCorrelation(e,c,a,null,null,null,j,!1,null,null,!1,d);if(Float.isNaN(m))return f?new JU.BS:L(-1,[]);this.e.showString("RMSD "+m+" Angstroms");j=j.toArray(Array(j.size()))}if(f){m=
new JU.BS;for(f=0;f<j.length;f++)m.or(j[f]);return m}m=new JU.Lst;for(f=0;f<j.length;f++)m.addLast(j[f]);return m},"~S,~S,JU.BS,JU.BS,~N,~B,~B");h(c$,"getFlexFitList",function(a,b,c,e){var d=JU.AU.newInt2(2);this.getSmilesCorrelation(a,b,c,null,null,null,null,!1,d,null,!1,e?2:1);if(null==d[0])return null;a=this.e.vwr.ms.getDihedralMap(d[0]);b=null==a?null:this.e.vwr.ms.getDihedralMap(d[1]);if(null==b||b.length!=a.length)return null;d=M(a.length,3,0);c=this.e.vwr.ms.at;JS.SmilesExt.getTorsions(c,b,
d,0);JS.SmilesExt.getTorsions(c,a,d,1);b=M(6*a.length,0);for(e=c=0;c<a.length;c++){var f=a[c];b[e++]=f[0];b[e++]=f[1];b[e++]=f[2];b[e++]=f[3];b[e++]=d[c][0];b[e++]=d[c][1]}return b},"JU.BS,JU.BS,~S,~B");c$.getTorsions=h(c$,"getTorsions",function(a,b,c,e){for(var d=b.length;0<=--d;){var f=b[d],f=JU.Measure.computeTorsion(a[f[0]],a[f[1]],a[f[2]],a[f[3]],!0);1==e&&(180<f-c[d][0]?f-=360:-180>=f-c[d][0]&&(f+=360));c[d][e]=f}},"~A,~A,~A,~N")})})(Clazz,Clazz.newLongArray,Clazz.doubleToByte,Clazz.doubleToInt,
Clazz.doubleToLong,Clazz.declarePackage,Clazz.instanceOf,Clazz.load,Clazz.instantialize,Clazz.decorateAsClass,Clazz.floatToInt,Clazz.floatToLong,Clazz.makeConstructor,Clazz.defineEnumConstant,Clazz.exceptionOf,Clazz.newIntArray,Clazz.defineStatics,Clazz.newFloatArray,Clazz.declareType,Clazz.prepareFields,Clazz.superConstructor,Clazz.newByteArray,Clazz.declareInterface,Clazz.p0p,Clazz.pu$h,Clazz.newShortArray,Clazz.innerTypeInstance,Clazz.isClassDefined,Clazz.prepareCallback,Clazz.newArray,Clazz.castNullAs,
Clazz.floatToShort,Clazz.superCall,Clazz.decorateAsType,Clazz.newBooleanArray,Clazz.newCharArray,Clazz.implementOf,Clazz.newDoubleArray,Clazz.overrideConstructor,Clazz.clone,Clazz.doubleToShort,Clazz.getInheritedLevel,Clazz.getParamsType,Clazz.isAF,Clazz.isAB,Clazz.isAI,Clazz.isAS,Clazz.isASS,Clazz.isAP,Clazz.isAFloat,Clazz.isAII,Clazz.isAFF,Clazz.isAFFF,Clazz.tryToSearchAndExecute,Clazz.getStackTrace,Clazz.inheritArgs,Clazz.alert,Clazz.defineMethod,Clazz.overrideMethod,Clazz.declareAnonymous,Clazz.cloneFinals);
